📦
530 /agent/index.js.map
1233 /agent/index.js
1878 /agent/constants.js.map
5735 /agent/constants.js
201 /agent/include.js.map
72 /agent/include.js
6202 /agent/logger.js.map
5737 /agent/logger.js
3149 /agent/plugin/breaker/breaker.js.map
3089 /agent/plugin/breaker/breaker.js
172 /agent/plugin/breaker/include.js.map
22 /agent/plugin/breaker/include.js
44471 /agent/plugin/cipher/cipher.js.map
46889 /agent/plugin/cipher/cipher.js
196 /agent/plugin/foundation/include.js.map
44 /agent/plugin/foundation/include.js
360 /agent/plugin/foundation/nsbundle.js.map
266 /agent/plugin/foundation/nsbundle.js
868 /agent/plugin/foundation/nslog.js.map
640 /agent/plugin/foundation/nslog.js
6703 /agent/plugin/hooks/dyld.js.map
9739 /agent/plugin/hooks/dyld.js
191 /agent/plugin/hooks/include.js.map
42 /agent/plugin/hooks/include.js
896 /agent/plugin/hooks/libdyld.js.map
606 /agent/plugin/hooks/libdyld.js
304 /agent/plugin/include.js.map
214 /agent/plugin/include.js
1832 /agent/plugin/jailbreak/enum.js.map
7617 /agent/plugin/jailbreak/enum.js
14085 /agent/plugin/jailbreak/hooks.js.map
21800 /agent/plugin/jailbreak/hooks.js
237 /agent/plugin/jailbreak/include.js.map
82 /agent/plugin/jailbreak/include.js
149 /agent/plugin/jailbreak/jail.js.map
10 /agent/plugin/jailbreak/jail.js
956 /agent/plugin/jailbreak/thread.js.map
894 /agent/plugin/jailbreak/thread.js
194 /agent/plugin/lang/include.js.map
54 /agent/plugin/lang/include.js
5298 /agent/plugin/lang/oc/ViewController.js.map
9821 /agent/plugin/lang/oc/ViewController.js
3390 /agent/plugin/lang/oc/button.js.map
7057 /agent/plugin/lang/oc/button.js
645 /agent/plugin/lang/oc/clazz.js.map
671 /agent/plugin/lang/oc/clazz.js
281 /agent/plugin/lang/oc/include.js.map
141 /agent/plugin/lang/oc/include.js
368 /agent/plugin/lang/oc/method.js.map
225 /agent/plugin/lang/oc/method.js
15842 /agent/plugin/lang/oc/oc.js.map
17236 /agent/plugin/lang/oc/oc.js
180 /agent/plugin/lang/oc/types/include.js.map
26 /agent/plugin/lang/oc/types/include.js
8322 /agent/plugin/lang/oc/types/objc_method.js.map
9535 /agent/plugin/lang/oc/types/objc_method.js
175 /agent/plugin/lang/swift/include.js.map
19 /agent/plugin/lang/swift/include.js
150 /agent/plugin/lang/swift/main.js.map
10 /agent/plugin/lang/swift/main.js
172 /agent/plugin/service/include.js.map
19 /agent/plugin/service/include.js
2578 /agent/plugin/service/main.js.map
3163 /agent/plugin/service/main.js
134 /agent/types.js.map
10 /agent/types.js
17023 /agent/utils.js.map
16710 /agent/utils.js
✄
{"version":3,"file":"index.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/index.ts"],"names":[],"mappings":"AAAA,OAAO,cAAc,CAAA;AACrB,OAAO,aAAa,CAAA;AAEpB,cAAc;AACd,gBAAgB;AAChB,oBAAoB;AAEpB,kEAAkE;AAClE,oCAAoC;AACpC,2HAA2H;AAC3H,gBAAgB;AAChB,KAAK;AACL,kEAAkE;AAClE,oCAAoC;AACpC,2HAA2H;AAC3H,gBAAgB;AAChB,KAAK;AAEL,wBAAwB,EAAE,CAAA;AAE1B,wBAAwB,EAAE,CAAA;AAE1B,gDAAgD;AAEhD,4FAA4F;AAC5F,sBAAsB;AACtB,+CAA+C;AAC/C,qDAAqD;AACrD,oDAAoD;AACpD,8FAA8F;AAC9F,QAAQ;AACR,KAAK;AAEL,mGAAmG;AAEnG,qBAAqB;AAErB,yBAAyB"}
✄
import './include.js';
import './logger.js';
// hook_exit()
// hook_strcmp()
// hook_all_detect()
// A(Module.getExportByName(null, "_pthread_start"),(args, ctx)=>{
//     logd("called _pthread_start")
//     let logs = `called from:\n${Thread.backtrace(ctx, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join('\n\t')}\n`
//     log(logs)
// })
// A(Module.getExportByName(null, "pthread_create"),(args, ctx)=>{
//     logd("called pthread_create")
//     let logs = `called from:\n${Thread.backtrace(ctx, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join('\n\t')}\n`
//     log(logs)
// })
hook_dyld_get_image_name();
hook_dyld_mod_init_funcs();
// -[NSFileManager fileExistsAtPath:0x107376360]
// Interceptor.attach(ObjC.classes["NSFileManager"]["- fileExistsAtPath:"].implementation, {
//     onEnter(args) {
//         const ins = new ObjC.Object(args[0])
//         const sel = ObjC.selectorAsString(args[1])
//         const nsstring = new ObjC.Object(args[3])
//         console.warn(`\nCalled NSFileManager ${ins} ${sel} fileExistsAtPath:'${nsstring}'`)
//     }
// })
// frida-trace -U -f  com.sysh.shajzmjl -m "*[NSFileManager *]" -i _dyld_get_image_name -i abort   
// B("UPWDeviceUtil")
// -m "*[* *canOpenURL*]"
✄
{"version":3,"file":"constants.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/constants.ts"],"names":[],"mappings":"AAAA,8CAA8C;AAC9C,kDAAkD;AAClD,MAAM,CAAN,IAAY,IAkDT;AAlDH,WAAY,IAAI;IAEZ,8DAA8D;IAC9D,oBAAoB;IAEpB,4BAA4B;IAC5B,kDAAkD;IAClD,gCAAgC;IAEhC,6CAAqC,CAAA;IACrC,iCAAyB,CAAA;IACzB,+BAAuB,CAAA;IACvB,kCAA0B,CAAA;IAC1B,wCAAgC,CAAA;IAChC,2BAAmB,CAAA;IACnB,6BAAqB,CAAA;IACrB,kCAA0B,CAAA;IAC1B,qCAA6B,CAAA;IAC7B,yCAAiC,CAAA;IACjC,0CAAkC,CAAA;IAClC,gCAAwB,CAAA;IACxB,gCAAwB,CAAA;IACxB,oCAA4B,CAAA;IAC5B,8BAAsB,CAAA;IACtB,qCAA6B,CAAA;IAC7B,sCAA8B,CAAA;IAC9B,gCAAwB,CAAA;IACxB,uCAA+B,CAAA;IAC/B,0CAAkC,CAAA;IAClC,yCAAiC,CAAA;IACjC,+BAAuB,CAAA;IACvB,oCAA4B,CAAA;IAC5B,gCAAwB,CAAA;IACxB,gCAAwB,CAAA;IACxB,6BAAqB,CAAA;IACrB,mCAA2B,CAAA;IAC3B,8BAAsB,CAAA;IACtB,oCAA4B,CAAA;IAC5B,mCAA2B,CAAA;IAC3B,sCAA8B,CAAA;IAC9B,0CAAkC,CAAA;IAClC,mCAA2B,CAAA;IAC3B,6CAAqC,CAAA;IACrC,iDAAyC,CAAA;IACzC,uCAA+B,CAAA;IAC/B,4DAAoD,CAAA;IACpD,gEAAwD,CAAA;IACxD,gEAAwD,CAAA;IACxD,sDAA8C,CAAA;IAC9C,gCAAwB,CAAA;AAC1B,CAAC,EAlDS,IAAI,KAAJ,IAAI,QAkDb;AAED,uDAAuD;AACvD,uFAAuF;AACvF,0GAA0G;AAC1G,2CAA2C;AAC3C,2JAA2J;AAC3J,iHAAiH;AACjH,2CAA2C;AAC3C,8HAA8H;AAC9H,2CAA2C;AAC3C,0IAA0I;AAC1I,+EAA+E;AAC/E,+EAA+E;AAC/E,uEAAuE;AACvE,kHAAkH;AAClH,2CAA2C;AAC3C,oIAAoI;AACpI,4EAA4E;AAC5E,sGAAsG;AACtG,2CAA2C;AAC3C,qIAAqI;AACrI,EAAE;AACF,qBAAqB;AACrB,EAAE;AACF,KAAK;AAEL,MAAM,CAAN,IAAY,aAeX;AAfD,WAAY,aAAa;IACvB,qFAA0B,CAAA;IAC1B,6FAA0B,CAAA;IAC1B,uGAA+B,CAAA;IAC/B,+FAA2B,CAAA;IAC3B,6EAAkB,CAAA;IAClB,iFAAoB,CAAA;IACpB,uEAAe,CAAA;IACf,yFAAwB,CAAA;IACxB,+EAAmB,CAAA;IACnB,sFAAsB,CAAA;IACtB,wGAA+B,CAAA;IAC/B,8EAAkB,CAAA;IAClB,4EAAiB,CAAA;IACjB,oGAA6B,CAAA;AAC/B,CAAC,EAfW,aAAa,KAAb,aAAa,QAexB;AAED,MAAM,CAAC,MAAM,gBAAgB,GAAG,CAAC,CAAC;AAClC,MAAM,CAAC,MAAM,oBAAoB,GAAG,CAAC,CAAC;AAEtC,MAAM,CAAN,IAAY,UAGX;AAHD,WAAY,UAAU;IACpB,qEAAqB,CAAA;IACrB,uEAAkB,CAAA;AACpB,CAAC,EAHW,UAAU,KAAV,UAAU,QAGrB"}
✄
// constants used for Security Attributes etc.
// NSLog(@"kSecAttrService: %@", kSecAttrService);
export var kSec;
(function (kSec) {
    // To reference some of the constants, the had to be echoed to
    // get their values.
    // NSLog(@"Constants Dump");
    // NSLog(@"kSecAttrService: %@", kSecAttrService);
    // NSLog(@"End Constants Dump");
    kSec["kSecReturnAttributes"] = "r_Attributes";
    kSec["kSecReturnData"] = "r_Data";
    kSec["kSecReturnRef"] = "r_Ref";
    kSec["kSecMatchLimit"] = "m_Limit";
    kSec["kSecMatchLimitAll"] = "m_LimitAll";
    kSec["kSecClass"] = "class";
    kSec["kSecClassKey"] = "keys";
    kSec["kSecClassIdentity"] = "idnt";
    kSec["kSecClassCertificate"] = "cert";
    kSec["kSecClassGenericPassword"] = "genp";
    kSec["kSecClassInternetPassword"] = "inet";
    kSec["kSecAttrService"] = "svce";
    kSec["kSecAttrAccount"] = "acct";
    kSec["kSecAttrAccessGroup"] = "agrp";
    kSec["kSecAttrLabel"] = "labl";
    kSec["kSecAttrCreationDate"] = "cdat";
    kSec["kSecAttrAccessControl"] = "accc";
    kSec["kSecAttrGeneric"] = "gena";
    kSec["kSecAttrSynchronizable"] = "sync";
    kSec["kSecAttrSynchronizableAny"] = "syna";
    kSec["kSecAttrModificationDate"] = "mdat";
    kSec["kSecAttrServer"] = "srvr";
    kSec["kSecAttrDescription"] = "desc";
    kSec["kSecAttrComment"] = "icmt";
    kSec["kSecAttrCreator"] = "crtr";
    kSec["kSecAttrType"] = "type";
    kSec["kSecAttrScriptCode"] = "scrp";
    kSec["kSecAttrAlias"] = "alis";
    kSec["kSecAttrIsInvisible"] = "invi";
    kSec["kSecAttrIsNegative"] = "nega";
    kSec["kSecAttrHasCustomIcon"] = "cusi";
    kSec["kSecProtectedDataItemAttr"] = "prot";
    kSec["kSecAttrAccessible"] = "pdmn";
    kSec["kSecAttrAccessibleWhenUnlocked"] = "ak";
    kSec["kSecAttrAccessibleAfterFirstUnlock"] = "ck";
    kSec["kSecAttrAccessibleAlways"] = "dk";
    kSec["kSecAttrAccessibleWhenUnlockedThisDeviceOnly"] = "aku";
    kSec["kSecAttrAccessibleWhenPasscodeSetThisDeviceOnly"] = "akpu";
    kSec["kSecAttrAccessibleAfterFirstUnlockThisDeviceOnly"] = "cku";
    kSec["kSecAttrAccessibleAlwaysThisDeviceOnly"] = "dku";
    kSec["kSecValueData"] = "v_Data";
})(kSec || (kSec = {}));
// typedef NS_ENUM(NSUInteger, NSSearchPathDirectory) {
//     NSApplicationDirectory = 1,             // supported applications (Applications)
//     NSDemoApplicationDirectory,             // unsupported applications, demonstration versions (Demos)
// tslint:disable-next-line:max-line-length
//     NSDeveloperApplicationDirectory,        // developer applications (Developer/Applications). DEPRECATED - there is no one single Developer directory.
//     NSAdminApplicationDirectory,            // system and network administration applications (Administration)
// tslint:disable-next-line:max-line-length
//     NSLibraryDirectory,                     // various documentation, support, and configuration files, resources (Library)
// tslint:disable-next-line:max-line-length
//     NSDeveloperDirectory,                   // developer resources (Developer) DEPRECATED - there is no one single Developer directory.
//     NSUserDirectory,                        // user home directories (Users)
//     NSDocumentationDirectory,               // documentation (Documentation)
//     NSDocumentDirectory,                    // documents (Documents)
//     NSCoreServiceDirectory,                 // location of CoreServices directory (System/Library/CoreServices)
// tslint:disable-next-line:max-line-length
//     NSAutosavedInformationDirectory NS_ENUM_AVAILABLE(10_6, 4_0) = 11,   // location of autosaved documents (Documents/Autosaved)
//     NSDesktopDirectory = 12,                // location of user's desktop
//     NSCachesDirectory = 13,                 // location of discardable cache files (Library/Caches)
// tslint:disable-next-line:max-line-length
//     NSApplicationSupportDirectory = 14,     // location of application support files (plug-ins, etc) (Library/Application Support)
//
//     [... snip ...]
//
// };
export var NSSearchPaths;
(function (NSSearchPaths) {
    NSSearchPaths[NSSearchPaths["NSApplicationDirectory"] = 1] = "NSApplicationDirectory";
    NSSearchPaths[NSSearchPaths["NSDemoApplicationDirectory"] = 2] = "NSDemoApplicationDirectory";
    NSSearchPaths[NSSearchPaths["NSDeveloperApplicationDirectory"] = 3] = "NSDeveloperApplicationDirectory";
    NSSearchPaths[NSSearchPaths["NSAdminApplicationDirectory"] = 4] = "NSAdminApplicationDirectory";
    NSSearchPaths[NSSearchPaths["NSLibraryDirectory"] = 5] = "NSLibraryDirectory";
    NSSearchPaths[NSSearchPaths["NSDeveloperDirectory"] = 6] = "NSDeveloperDirectory";
    NSSearchPaths[NSSearchPaths["NSUserDirectory"] = 7] = "NSUserDirectory";
    NSSearchPaths[NSSearchPaths["NSDocumentationDirectory"] = 8] = "NSDocumentationDirectory";
    NSSearchPaths[NSSearchPaths["NSDocumentDirectory"] = 9] = "NSDocumentDirectory";
    NSSearchPaths[NSSearchPaths["NSCoreServiceDirectory"] = 10] = "NSCoreServiceDirectory";
    NSSearchPaths[NSSearchPaths["NSAutosavedInformationDirectory"] = 11] = "NSAutosavedInformationDirectory";
    NSSearchPaths[NSSearchPaths["NSDesktopDirectory"] = 12] = "NSDesktopDirectory";
    NSSearchPaths[NSSearchPaths["NSCachesDirectory"] = 13] = "NSCachesDirectory";
    NSSearchPaths[NSSearchPaths["NSApplicationSupportDirectory"] = 14] = "NSApplicationSupportDirectory";
})(NSSearchPaths || (NSSearchPaths = {}));
export const NSUserDomainMask = 1;
export const NSUTF8StringEncoding = 4;
export var BundleType;
(function (BundleType) {
    BundleType[BundleType["NSBundleFramework"] = 1] = "NSBundleFramework";
    BundleType[BundleType["NSBundleAllBundles"] = 2] = "NSBundleAllBundles";
})(BundleType || (BundleType = {}));
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/include.ts"],"names":[],"mappings":"AAAA,OAAO,aAAa,CAAA;AACpB,OAAO,YAAY,CAAA;AAEnB,OAAO,qBAAqB,CAAA"}
✄
import './logger.js';
import './utils.js';
import './plugin/include.js';
✄
{"version":3,"file":"logger.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/logger.ts"],"names":[],"mappings":"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"}
✄
export var LogColor;
(function (LogColor) {
    LogColor[LogColor["WHITE"] = 0] = "WHITE";
    LogColor[LogColor["RED"] = 1] = "RED";
    LogColor[LogColor["YELLOW"] = 3] = "YELLOW";
    LogColor[LogColor["C31"] = 31] = "C31";
    LogColor[LogColor["C32"] = 32] = "C32";
    LogColor[LogColor["C33"] = 33] = "C33";
    LogColor[LogColor["C34"] = 34] = "C34";
    LogColor[LogColor["C35"] = 35] = "C35";
    LogColor[LogColor["C36"] = 36] = "C36";
    LogColor[LogColor["C41"] = 41] = "C41";
    LogColor[LogColor["C42"] = 42] = "C42";
    LogColor[LogColor["C43"] = 43] = "C43";
    LogColor[LogColor["C44"] = 44] = "C44";
    LogColor[LogColor["C45"] = 45] = "C45";
    LogColor[LogColor["C46"] = 46] = "C46";
    LogColor[LogColor["C90"] = 90] = "C90";
    LogColor[LogColor["C91"] = 91] = "C91";
    LogColor[LogColor["C92"] = 92] = "C92";
    LogColor[LogColor["C93"] = 93] = "C93";
    LogColor[LogColor["C94"] = 94] = "C94";
    LogColor[LogColor["C95"] = 95] = "C95";
    LogColor[LogColor["C96"] = 96] = "C96";
    LogColor[LogColor["C97"] = 97] = "C97";
    LogColor[LogColor["C100"] = 100] = "C100";
    LogColor[LogColor["C101"] = 101] = "C101";
    LogColor[LogColor["C102"] = 102] = "C102";
    LogColor[LogColor["C103"] = 103] = "C103";
    LogColor[LogColor["C104"] = 104] = "C104";
    LogColor[LogColor["C105"] = 105] = "C105";
    LogColor[LogColor["C106"] = 106] = "C106";
    LogColor[LogColor["C107"] = 107] = "C107";
})(LogColor || (LogColor = {}));
export class Logger {
    static callOnce(func) {
        let called = false;
        return ((...args) => {
            if (!called) {
                called = true;
                return func(...args);
            }
        });
    }
}
Logger.linesMap = new Map();
Logger.colorEndDes = "\x1b[0m";
Logger.colorStartDes = (color) => `\x1b[${color}m`;
Logger.LOGW = (msg) => Logger.LOG(msg, LogColor.YELLOW);
Logger.LOGE = (msg) => Logger.LOG(msg, LogColor.RED);
Logger.LOGG = (msg) => Logger.LOG(msg, LogColor.C32);
Logger.LOGD = (msg) => Logger.LOG(msg, LogColor.C36);
Logger.LOGN = (msg) => Logger.LOG(msg, LogColor.C35);
Logger.LOGO = (msg) => Logger.LOG(msg, LogColor.C33);
Logger.LOGP = (msg) => Logger.LOG(msg, LogColor.C34);
Logger.LOGM = (msg) => Logger.LOG(msg, LogColor.C92);
Logger.LOGH = (msg) => Logger.LOG(msg, LogColor.C95);
Logger.LOGS = (msg) => Logger.LOG(msg, LogColor.C96);
Logger.LOGZ = (msg) => Logger.LOG(msg, LogColor.C90);
Logger.LOGLL = (msg) => Logger.LOG(msg, LogColor.C100);
Logger.LOGJSON = (obj, type = LogColor.C36, space = 1) => Logger.LOG(JSON.stringify(obj, null, space), type);
Logger.logL = console.log;
Logger.LOG = (str, type = LogColor.WHITE) => {
    switch (type) {
        case LogColor.WHITE:
            Logger.logL(str);
            break;
        case LogColor.RED:
            console.error(str);
            break;
        case LogColor.YELLOW:
            console.warn(str);
            break;
        default:
            Logger.logL("\x1b[" + type + "m" + str + "\x1b[0m");
            break;
    }
};
Logger.printLogColors = () => {
    let str = "123456789";
    Logger.logL(`\n${getLine(16)}  listLogColors  ${getLine(16)}`);
    for (let i = 30; i <= 37; i++) {
        Logger.logL(`\t\t${Logger.colorStartDes(i)} C${i}\t${str} ${Logger.colorEndDes}`);
    }
    Logger.logL(getLine(50));
    for (let i = 40; i <= 47; i++) {
        Logger.logL(`\t\t${Logger.colorStartDes(i)} C${i}\t${str} ${Logger.colorEndDes}`);
    }
    Logger.logL(getLine(50));
    for (let i = 90; i <= 97; i++) {
        Logger.logL(`\t\t${Logger.colorStartDes(i)} C${i}\t${str} ${Logger.colorEndDes}`);
    }
    Logger.logL(getLine(50));
    for (let i = 100; i <= 107; i++) {
        Logger.logL(`\t\t${Logger.colorStartDes(i)} C${i}\t${str} ${Logger.colorEndDes}`);
    }
    Logger.logL(getLine(50));
};
// log(chalk.red("this"), chalk.blue("is"), chalk.green("a"), chalk.yellow("test"))
// chalk.bold chalk.rgb 在 frida 这里不好使
// static logFormart = (...text: chalk.Chalk[] | string[]) => logL(...text)
Logger.getLine = (length, fillStr = "-") => {
    if (length == 0)
        return "";
    let key = length + "|" + fillStr;
    if (Logger.linesMap.get(key) != null)
        return Logger.linesMap.get(key);
    for (var index = 0, tmpRet = ""; index < length; index++)
        tmpRet += fillStr;
    Logger.linesMap.set(key, tmpRet);
    return tmpRet;
};
// build a text with color (use LOG to print)
Logger.getTextFormart = (text, color = LogColor.WHITE, fillStr = " ", length = -1, center = false) => {
    if (text == undefined)
        text = "";
    if (length == -1)
        length = text.length;
    let ret = Logger.colorStartDes(color);
    let fillLength = length - text.length;
    if (fillLength > 0) {
        let left = Math.floor(fillLength / 2);
        let right = fillLength - left;
        if (center) {
            left = right;
        }
        ret += getLine(left, fillStr) + text + getLine(right, fillStr);
    }
    else {
        ret += text;
    }
    ret += Logger.colorEndDes;
    return ret;
};
globalThis.log = Logger.LOG;
globalThis.logw = Logger.LOGW;
globalThis.loge = Logger.LOGE;
globalThis.logg = Logger.LOGG;
globalThis.logd = Logger.LOGD;
globalThis.logn = Logger.LOGN;
globalThis.logo = Logger.LOGO;
globalThis.logp = Logger.LOGP;
globalThis.logh = Logger.LOGH;
globalThis.logm = Logger.LOGM;
globalThis.logz = Logger.LOGZ;
globalThis.logs = Logger.LOGS;
globalThis.logl = Logger.LOGLL;
globalThis.LOGJSON = Logger.LOGJSON;
globalThis.getLine = Logger.getLine;
globalThis.printLogColors = Logger.printLogColors;
globalThis.newLine = (lines = 1) => Logger.LOG(getLine(lines, "\n"));
globalThis.LogColor = LogColor;
// globalThis.log = logFormart // alias log <= logFormart
✄
{"version":3,"file":"breaker.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/breaker/breaker.ts"],"names":[],"mappings":"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"}
✄
import { HK_TYPE } from "../../utils.js";
class Breaker {
    // ref function ptr => IMP
    static attachImpl(mPtr, defaultArgsC = 4) {
        new objc_method(addressToMethod(checkPointer(mPtr)).handle).hook(HK_TYPE.FRIDA_REP, true, defaultArgsC);
    }
    //  ref Method => Method
    static attachMethod(mPtr, force = false) {
        new objc_method(mPtr).hook(HK_TYPE.OBJC_REP, true, 6, force);
    }
    // ref Class / ObjC.Object
    static attachClass(mPtr, filterMethodNameStr = '', force = false) {
        if (typeof mPtr == "string" && mPtr.startsWith("0x"))
            mPtr = ptr(mPtr);
        const localPtr = checkPointer(mPtr);
        const localObj = new ObjC.Class(localPtr); // ref Class
        Breaker.itorMethod(localObj, (method, _impl) => {
            const methodName = `${ObjC.selectorAsString(method.selector)}`;
            if (methodName.includes(filterMethodNameStr))
                Breaker.attachMethod(method.handle, force);
            // else logz(`${method.implementation} -> ${methodName} | Warn: filter method name`)
        });
    }
    static itorMethod(obj, callback) {
        obj.$ownMethods.forEach(m => {
            let method;
            let impl;
            try {
                method = obj[m];
                try {
                    impl = method.implementation;
                }
                catch (error) {
                    impl = OC_Hook_Status.getNewImplFromOCMethod(method);
                }
            }
            catch (error) {
                const selector = call("NSSelectorFromString", allocOCString(m.substring(m.indexOf(' ') + 1)));
                const method_ptr = call("class_getInstanceMethod", obj, selector);
                method = new ObjC.Object(method_ptr);
                impl = call("method_getImplementation", method);
            }
            callback(method, impl);
        });
    }
    static attachMethodsByFilter(filterName, filterClass = '', type = "objc") {
        if (filterName == undefined || filterName.length == 0)
            throw new Error('Need args[0] filterStr: string');
        let filter = filterName;
        if (filterClass != undefined && filterClass != '' && !filterName.includes("[")) {
            filter = `*[${filterClass} *${filterName}*]`;
        }
        else if (!filterName.includes("[")) {
            filter = `*[* *${filterName}*]`;
        }
        new ApiResolver(type).enumerateMatches(filter).forEach((item, index) => {
            try {
                const method = addressToMethod(item.address);
                const md = Process.findModuleByAddress(item.address);
                logd(`[${index}] \taddr:${item.address} offset:${md?.name}@${item.address.sub(md?.base)} ${item.name} ObjM:${method.handle}`);
                Breaker.attachMethod(method.handle);
            }
            catch (error) {
                loge(`${item.address} ${error}`);
            }
        });
    }
}
globalThis.b = (mPtr) => { Breaker.attachMethod(mPtr, true); };
globalThis.B = Breaker.attachClass;
globalThis.BF = Breaker.attachMethodsByFilter;
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/breaker/include.ts"],"names":[],"mappings":"AAAA,OAAO,cAAc,CAAA"}
✄
import './breaker.js';
✄
{"version":3,"file":"cipher.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/cipher/cipher.ts"],"names":[],"mappings":"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"}
✄
/*************************************************************************************
 * Name: frida-ios-cipher
 * OS: iOS
 * Author: @humenger
 * Source: https://github.com/humenger/frida-ios-cipher
 * Desc: Intercept all cryptography-related functions on iOS with Frida Api.
 * refs:https://opensource.apple.com/source/CommonCrypto/CommonCrypto-36064/CommonCrypto/CommonCryptor.h
 * refs:https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/CC_MD5.3cc.html#//apple_ref/doc/man/3cc/CC_MD5
 * refs:https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/CC_SHA.3cc.html#//apple_ref/doc/man/3cc/CC_SHA
 * refs:https://developer.apple.com/library/archive/documentation/System/Conceptual/ManPages_iPhoneOS/man3/CCCryptor.3cc.html#//apple_ref/doc/man/3cc/CCCryptor
 * refs:https://opensource.apple.com/source/CommonCrypto/CommonCrypto-55010/CommonCrypto/CommonKeyDerivation.h.auto.html
 * refs:https://www.cnblogs.com/cocoajin/p/6150203.html
 * refs:https://frida.re/docs/javascript-api/
 * refs:https://codeshare.frida.re/@xperylab/cccrypt-dump/
 * refs:https://github.com/federicodotta/Brida
 * refs:https://github.com/sensepost/objection/blob/master/agent/src/ios/crypto.ts
 * refs:https://opensource.apple.com/source/CommonCrypto/CommonCrypto-60118.200.6/lib/CommonCryptor.c.auto.html
 * refs:https://opensource.apple.com/source/CommonCrypto/CommonCrypto-60026/CommonCrypto/CommonCryptor.h.auto.html
 * refs:https://www.jianshu.com/p/8896ed432dff
 * refs:https://opensource.apple.com/source/CommonCrypto/CommonCrypto-60118.200.6/lib/
 * refs:https://blog.csdn.net/q187543/article/details/103920969
 **************************************************************************************/
//config
const CIPHER_CONFIG = {
    "enable": false,
    "highlighting": true,
    "crypto": {
        "enable": true,
        "maxDataLength": 240,
        "printStack": false,
        "aes": true,
        "des": true,
        "3des": true,
        "cast": true,
        "rc4": true,
        "rc2": true,
        "blowfish": true,
        "filter": []
    },
    "hash": {
        "enable": true,
        "maxInputDataLength": 240,
        "printStack": false,
        "md2": true,
        "md4": true,
        "md5": true,
        "sha1": true,
        "sha224": true,
        "sha256": true,
        "sha384": true,
        "sha512": true,
        "filter": []
    },
    "hmac": {
        "enable": true,
        "maxInputDataLength": 240,
        "printStack": false,
        "sha1": true,
        "md5": true,
        "sha224": true,
        "sha256": true,
        "sha384": true,
        "sha512": true,
        "filter": []
    },
    "pbkdf": {
        "enable": true,
        "printStack": false,
        "filter": []
    }
};
//common
const COLORS = {
    "resetColor": CIPHER_CONFIG.highlighting ? "\x1b[0m" : "",
    "bold": CIPHER_CONFIG.highlighting ? "\x1b[1m" : "",
    "dim": CIPHER_CONFIG.highlighting ? "\x1b[2m" : "",
    "italic": CIPHER_CONFIG.highlighting ? "\x1b[3m" : "",
    "underline": CIPHER_CONFIG.highlighting ? "\x1b[4m" : "",
    "blink": CIPHER_CONFIG.highlighting ? "\x1b[5m" : "",
    "reverse": CIPHER_CONFIG.highlighting ? "\x1b[7m" : "",
    "hidden": CIPHER_CONFIG.highlighting ? "\x1b[8m" : "",
    "black": CIPHER_CONFIG.highlighting ? "\x1b[30m" : "",
    "red": CIPHER_CONFIG.highlighting ? "\x1b[31m" : "",
    "green": CIPHER_CONFIG.highlighting ? "\x1b[32m" : "",
    "yellow": CIPHER_CONFIG.highlighting ? "\x1b[33m" : "",
    "blue": CIPHER_CONFIG.highlighting ? "\x1b[34m" : "",
    "magenta": CIPHER_CONFIG.highlighting ? "\x1b[35m" : "",
    "cyan": CIPHER_CONFIG.highlighting ? "\x1b[36m" : "",
    "white": CIPHER_CONFIG.highlighting ? "\x1b[37m" : "",
    "bgBlack": CIPHER_CONFIG.highlighting ? "\x1b[40m" : "",
    "bgRed": CIPHER_CONFIG.highlighting ? "\x1b[41m" : "",
    "bgGreen": CIPHER_CONFIG.highlighting ? "\x1b[42m" : "",
    "bgYellow": CIPHER_CONFIG.highlighting ? "\x1b[43m" : "",
    "bgBlue": CIPHER_CONFIG.highlighting ? "\x1b[44m" : "",
    "bgMagenta": CIPHER_CONFIG.highlighting ? "\x1b[45m" : "",
    "bgCyan": CIPHER_CONFIG.highlighting ? "\x1b[46m" : "",
    "bgWhite": CIPHER_CONFIG.highlighting ? "\x1b[47m" : ""
};
const CC_MD2_DIGEST_LENGTH = 16;
const CC_MD4_DIGEST_LENGTH = 16;
const CC_MD5_DIGEST_LENGTH = 16;
const CC_SHA1_DIGEST_LENGTH = 20;
const CC_SHA224_DIGEST_LENGTH = 28;
const CC_SHA256_DIGEST_LENGTH = 32;
const CC_SHA384_DIGEST_LENGTH = 48;
const CC_SHA512_DIGEST_LENGTH = 64;
const CCOperation = {
    0: "kCCEncrypt",
    1: "kCCEncrypt",
    3: "kCCBoth" //Private Cryptor direction (op)
};
const CCAlgorithm = {
    0: "kCCAlgorithmAES",
    1: "kCCAlgorithmDES",
    2: "kCCAlgorithm3DES",
    3: "kCCAlgorithmCAST",
    4: "kCCAlgorithmRC4",
    5: "kCCAlgorithmRC2",
    6: "kCCAlgorithmBlowfish"
};
const CCOptions = {
    //options for block ciphers
    1: "kCCOptionPKCS7Padding",
    2: "kCCOptionECBMode"
    //stream ciphers currently have no options
};
const CCMode = {
    1: "kCCModeECB",
    2: "kCCModeCBC",
    3: "kCCModeCFB",
    4: "kCCModeCTR",
    5: "kCCModeF8",
    6: "kCCModeLRW",
    7: "kCCModeOFB",
    8: "kCCModeXTS",
    9: "kCCModeRC4",
    10: "kCCModeCFB8",
    11: "kCCModeGCM",
    12: "kCCModeCCM"
};
const CCPadding = {
    0: "ccNoPadding",
    1: "ccPKCS7Padding",
    12: "ccCBCCTS3" //Private Paddings
};
const CCModeOptions = {
    0x0001: "kCCModeOptionCTR_LE",
    0x0002: "kCCModeOptionCTR_BE"
};
const CCKeySize = {
    16: "kCCKeySizeAES128|kCCKeySizeMaxCAST",
    24: "kCCKeySizeAES192|kCCKeySize3DES",
    32: "kCCKeySizeAES256",
    8: "kCCKeySizeDES|kCCKeySizeMinBlowfish",
    5: "kCCKeySizeMinCAST",
    1: "kCCKeySizeMinRC4|kCCKeySizeMinRC2",
    512: "kCCKeySizeMaxRC4",
    128: "kCCKeySizeMaxRC2",
    56: "kCCKeySizeMaxBlowfish"
};
const CCHmacAlgorithm = {
    0: "kCCHmacAlgSHA1",
    1: "kCCHmacAlgMD5",
    2: "kCCHmacAlgSHA256",
    3: "kCCHmacAlgSHA384",
    4: "kCCHmacAlgSHA512",
    5: "kCCHmacAlgSHA224",
};
const CCHmacAlgorithmLength = {
    0: CC_SHA1_DIGEST_LENGTH,
    1: CC_MD5_DIGEST_LENGTH,
    2: CC_SHA256_DIGEST_LENGTH,
    3: CC_SHA384_DIGEST_LENGTH,
    4: CC_SHA512_DIGEST_LENGTH,
    5: CC_SHA224_DIGEST_LENGTH,
};
const CCPseudoRandomAlgorithm = {
    1: "kCCPRFHmacAlgSHA1",
    2: "kCCPRFHmacAlgSHA224",
    3: "kCCPRFHmacAlgSHA256",
    4: "kCCPRFHmacAlgSHA384",
    5: "kCCPRFHmacAlgSHA512",
};
const CCPBKDFAlgorithm = {
    2: "kCCPBKDF2"
};
// @ts-ignore
function print_arg(addr, len = 240) {
    try {
        if (addr == null)
            return "\n";
        return "\n" + (hexdump(addr, { length: len })) + "\n";
    }
    catch (e) {
        if (e instanceof Error) {
            console.error("print_arg error:", e.stack);
        }
        return addr + "\n";
    }
}
function pointerToInt(ptr) {
    try {
        if (ptr == null)
            return 0;
        return parseInt(ptr.toString());
    }
    catch (e) {
        if (e instanceof Error) {
            console.error("pointerToInt error:", e.stack);
        }
        return 0;
    }
}
function filterLog(msg, filter) {
    if (filter == null || filter.length == 0) {
        console.log(msg);
    }
    else {
        var hasFilter = false;
        for (let value of filter) {
            if (value == null || value.length == 0)
                continue;
            hasFilter = true;
            if (msg.indexOf(value) >= 0) {
                console.log(msg);
                return;
            }
        }
        if (!hasFilter) {
            console.log(msg);
        }
    }
}
function fixHexDump(hex) {
    // @ts-ignore
    var ret = "";
    const lines = hex.split("\n");
    for (const line of lines) {
        const parts = line.split("");
        if (parts.length <= 58) {
            parts.splice(parts.length, 0, '\n');
        }
        else {
            parts.splice(parts.length, 0, '|\n');
            parts.splice(59, 0, '|');
        }
        parts.splice(0, 2);
        ret += parts.join("");
    }
    return ret;
}
function commonCryptoInterceptor() {
    function checkCryptoAlgorithmEnable(algorithm) {
        switch (algorithm) {
            case 0:
                return CIPHER_CONFIG.crypto.aes;
            case 1:
                return CIPHER_CONFIG.crypto.des;
            case 2:
                return CIPHER_CONFIG.crypto["3des"];
            case 3:
                return CIPHER_CONFIG.crypto.cast;
            case 4:
                return CIPHER_CONFIG.crypto.rc4;
            case 5:
                return CIPHER_CONFIG.crypto.rc2;
            case 6:
                return CIPHER_CONFIG.crypto.blowfish;
            default:
                return true;
        }
    }
    //CCCryptorStatus CCCrypt(
    // 	CCOperation op,			/* kCCEncrypt, etc. */
    // 	CCAlgorithm alg,		/* kCCAlgorithmAES128, etc. */
    // 	CCOptions options,		/* kCCOptionPKCS7Padding, etc. */
    // 	const void *key,
    // 	size_t keyLength,
    // 	const void *iv,			/* optional initialization vector */
    // 	const void *dataIn,		/* optional per op and alg */
    // 	size_t dataInLength,
    // 	void *dataOut,			/* data RETURNED here */
    // 	size_t dataOutAvailable,
    // 	size_t *dataOutMoved);
    let func = Module.findExportByName("libSystem.B.dylib", "CCCrypt");
    if (func == null) {
        console.error("CCCrypt func is null");
        return;
    }
    Interceptor.attach(func, {
        onEnter: function (args) {
            this.enable = checkCryptoAlgorithmEnable(args[1].toInt32());
            if (!this.enable)
                return;
            this.log = "";
            this.log = this.log.concat(COLORS.green, "[*] ENTER CCCrypt", COLORS.resetColor);
            this.log = this.log.concat(COLORS.yellow, "[+] CCOperation: " + CCOperation[args[0].toInt32()], COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.yellow, "[+] CCAlgorithm: " + CCAlgorithm[args[1].toInt32()], COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.yellow, "[+] CCOptions: " + CCOptions[args[2].toInt32()], COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.yellow, "[+] KeySize: " + CCKeySize[args[4].toInt32()], COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.cyan, "[+] Key: \n" + print_arg(args[3], args[4].toInt32()), COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.cyan, "[+] IV: \n" + print_arg(args[5], 16), COLORS.resetColor, "\n");
            let dataInLength = pointerToInt(args[7]);
            let printLength = Math.min(dataInLength, CIPHER_CONFIG.crypto.maxDataLength);
            this.log = this.log.concat("[+] Data len: ", printLength, "/", dataInLength, "\n");
            this.log = this.log.concat("[+] Data : \n", "\n");
            this.log = this.log.concat(print_arg(args[6], printLength));
            this.dataOut = args[8];
            this.dataOutLength = args[10];
        },
        onLeave: function (retval) {
            if (!this.enable)
                return;
            let dataOutLen = pointerToInt(this.dataOutLength.readPointer());
            let printOutLen = Math.min(dataOutLen, CIPHER_CONFIG.crypto.maxDataLength);
            this.log = this.log.concat(COLORS.magenta, "[+] Data out len: ", printOutLen, "/", dataOutLen, "\n");
            this.log = this.log.concat("[+] Data out: \n", print_arg(this.dataOut, printOutLen), "\n", COLORS.resetColor);
            if (CIPHER_CONFIG.crypto.printStack) {
                this.log = this.log.concat(COLORS.blue, "[+] stack:\n", Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join("\n"), COLORS.resetColor, "\n");
            }
            this.log = this.log.concat(COLORS.green, "[*] EXIT CCCrypt", COLORS.resetColor, "\n");
            filterLog(this.log, CIPHER_CONFIG.crypto.filter);
        }
    });
    let cRefCache = {};
    //CCCryptorStatus CCCryptorCreate(CCOperation op, CCAlgorithm alg, CCOptions options, const void *key, size_t keyLength, const void *iv,CCCryptorRef *cryptorRef);
    let CCCryptorCreate = Module.findExportByName("libSystem.B.dylib", "CCCryptorCreate");
    if (CCCryptorCreate == null) {
        console.error("CCCryptorCreate func is null ");
        return;
    }
    Interceptor.attach(CCCryptorCreate, {
        onEnter: function (args) {
            this.params = [];
            for (let i = 0; i < 7; i++) {
                this.params.push(args[i]);
            }
        },
        onLeave: function (reval) {
            let model = {
                enable: checkCryptoAlgorithmEnable(this.params[1]),
                cRef: this.params[6].readPointer(),
                dataMap: [],
                dataOutMap: [],
                totalLen: 0,
                totalOutLen: 0,
                originalLen: 0,
                originalOutLen: 0,
                log: "",
                finish: false,
                CCAlgorithm: "",
                CCOperation: "",
                CCMode: "",
                CCKeySize: "",
                CCModeOptions: "",
                CCPadding: "",
                Key: "",
                Iv: "null",
                Tweak: "",
                TweakLen: "",
                NumRounds: ""
            };
            cRefCache[pointerToInt(model.cRef)] = model;
            if (!model.enable)
                return;
            model.log = model.log.concat(COLORS.green, "[*] ENTER CCCryptorCreate", COLORS.resetColor, "\n");
            model.log = model.log.concat(COLORS.yellow, "[+] CCOperation: ", model.CCOperation = CCOperation[this.params[0].toInt32()], COLORS.resetColor, "\n");
            model.log = model.log.concat(COLORS.yellow, "[+] CCAlgorithm: " + CCAlgorithm[this.params[1].toInt32()], COLORS.resetColor, "\n");
            // model.log=model.log.concat(COLORS.yellow,"[+] CCOptions: " + CCOptions[this.options.toInt32()],COLORS.resetColor,"\n");
            model.log = model.log.concat(COLORS.cyan, "[+] Key len: ", model.CCKeySize = CCKeySize[this.params[4].toInt32()], COLORS.resetColor, "\n");
            model.log = model.log.concat(COLORS.cyan, "[+] Key: \n", model.Key = print_arg(this.params[3], pointerToInt(this.params[4])), COLORS.resetColor, "\n");
            if (pointerToInt(this.params[5]) != 0) {
                model.log = model.log.concat(COLORS.cyan, "[+] Iv:\n", model.Iv = print_arg(this.params[5], 16), COLORS.resetColor, "\n");
            }
            else {
                model.log = model.log.concat(COLORS.red, "[!] Iv: null", "\n", COLORS.resetColor);
            }
        }
    });
    //CCCryptorStatus CCCryptorCreateWithMode(
    //     CCOperation 	op,				/* kCCEncrypt, kCCEncrypt */
    //     CCMode			mode,
    //     CCAlgorithm		alg,
    //     CCPadding		padding,
    //     const void 		*iv,			/* optional initialization vector */
    //     const void 		*key,			/* raw key material */
    //     size_t 			keyLength,
    //     const void 		*tweak,			/* raw tweak material */  //for mode: XTS
    //     size_t 			tweakLength,
    //     int				numRounds,		/* 0 == default */
    //     CCModeOptions 	options,
    //     CCCryptorRef	*cryptorRef)	/* RETURNED */
    let CCCryptorCreateWithMode = Module.findExportByName("libSystem.B.dylib", "CCCryptorCreateWithMode");
    if (CCCryptorCreateWithMode == null) {
        console.error("CCCryptorCreateWithMode func is null ");
        return;
    }
    Interceptor.attach(CCCryptorCreateWithMode, {
        onEnter: function (args) {
            this.params = [];
            for (let i = 0; i < 12; i++) {
                this.params.push(args[i]);
            }
        },
        onLeave: function (reval) {
            let model = {
                enable: checkCryptoAlgorithmEnable(this.params[2]),
                cRef: ptr(0),
                dataMap: [],
                dataOutMap: [],
                totalLen: 0,
                totalOutLen: 0,
                originalLen: 0,
                originalOutLen: 0,
                log: "",
                finish: false,
                CCAlgorithm: "",
                CCOperation: "",
                CCMode: "",
                CCKeySize: "",
                CCModeOptions: "",
                CCPadding: "",
                Key: "",
                Iv: "null",
                Tweak: "",
                TweakLen: "",
                NumRounds: ""
            };
            try {
                model.cRef = this.params[11].readPointer();
            }
            catch (e) {
                console.log("Error: read CCCryptorRef failed:", e);
                return;
            }
            cRefCache[pointerToInt(model.cRef)] = model;
            if (!model.enable)
                return;
            model.log = model.log.concat(COLORS.green, "[*] ENTER CCCryptorCreateWithMode", COLORS.resetColor, "\n");
            model.log = model.log.concat(COLORS.yellow, "[+] CCOperation: ", model.CCOperation = CCOperation[this.params[0].toInt32()], COLORS.resetColor, "\n");
            model.log = model.log.concat(COLORS.yellow, "[+] CCMode: ", model.CCMode = CCMode[this.params[1].toInt32()], COLORS.resetColor, "\n");
            model.log = model.log.concat(COLORS.yellow, "[+] CCAlgorithm: ", model.CCAlgorithm = CCAlgorithm[this.params[2].toInt32()], COLORS.resetColor, "\n");
            model.log = model.log.concat(COLORS.yellow, "[+] CCPadding: ", model.CCPadding = CCPadding[this.params[3].toInt32()], COLORS.resetColor, "\n");
            model.log = model.log.concat(COLORS.yellow, "[+] CCModeOptions: ", model.CCModeOptions = CCModeOptions[this.params[10].toInt32()], COLORS.resetColor, "\n");
            let tweakLen = this.params[8].toInt32();
            if (tweakLen > 0 && pointerToInt(this.params[7]) != 0) {
                model.log = model.log.concat(COLORS.cyan, "[+] tweak len: ", model.TweakLen = tweakLen, COLORS.resetColor, "\n");
                model.log = model.log.concat(COLORS.cyan, "[+] tweak: \n", model.Tweak = print_arg(this.params[7], pointerToInt(this.params[8])), COLORS.resetColor, "\n");
            }
            model.log = model.log.concat(COLORS.cyan, "[+] numRounds: ", model.NumRounds = this.params[9].toInt32(), COLORS.resetColor, "\n");
            model.log = model.log.concat(COLORS.cyan, "[+] Key len: ", model.CCKeySize = CCKeySize[this.params[6].toInt32()], COLORS.resetColor, "\n");
            model.log = model.log.concat(COLORS.cyan, "[+] Key: \n", model.Key = print_arg(this.params[5], pointerToInt(this.params[6])), COLORS.resetColor, "\n");
            if (pointerToInt(this.params[4]) != 0) {
                model.log = model.log.concat(COLORS.cyan, "[+] Iv:\n", model.Iv = print_arg(this.params[4], 16), COLORS.resetColor, "\n");
            }
            else {
                model.log = model.log.concat(COLORS.red, "[!] Iv: null", "\n", COLORS.resetColor);
            }
        }
    });
    //CCCryptorStatus CCCryptorUpdate(CCCryptorRef cryptorRef, const void *dataIn,size_t dataInLength, void *dataOut, size_t dataOutAvailable,size_t *dataOutMoved);
    let CCCryptorUpdate = Module.findExportByName("libSystem.B.dylib", "CCCryptorUpdate");
    if (CCCryptorUpdate == null) {
        console.error("CCCryptorUpdate func is null");
        return;
    }
    Interceptor.attach(CCCryptorUpdate, {
        onEnter: function (args) {
            this.params = [];
            for (let i = 0; i < 6; i++) {
                this.params.push(args[i]);
            }
        },
        onLeave: function (retval) {
            let model = cRefCache[pointerToInt(this.params[0])];
            if (model == null) {
                model = {
                    enable: CIPHER_CONFIG.crypto.enable,
                    cRef: this.params[0],
                    dataMap: [],
                    dataOutMap: [],
                    totalLen: 0,
                    totalOutLen: 0,
                    originalLen: 0,
                    originalOutLen: 0,
                    log: "",
                    finish: false,
                    CCAlgorithm: "",
                    CCOperation: "",
                    CCMode: "",
                    CCKeySize: "",
                    CCModeOptions: "",
                    CCPadding: "",
                    Key: "",
                    Iv: "",
                    Tweak: "",
                    TweakLen: "",
                    NumRounds: ""
                };
                model.log = model.log.concat(COLORS.green, "[*] ENTER CCCryptorUpdate (note: Cannot be associated with an existing CCCryptorRef, so the data encryption parameters are unknown, However, a list of encryption instances that are currently still being processed can be provided here.)", COLORS.resetColor, "\n");
                model.log = model.log.concat(COLORS.blue, "[=] The list is as follows:", COLORS.resetColor, "\n");
                for (let cRefCacheKey in cRefCache) {
                    let value = cRefCache[cRefCacheKey];
                    if (value != null && !value.finish) {
                        model.log = model.log.concat(COLORS.cyan, "[+] CCCryptorRef: ", "" + value.cRef + "(pointer)", " dump:\n", COLORS.resetColor, "\n");
                        model.log = model.log.concat(COLORS.yellow, "[+] : CCAlgorithm: ", value.CCAlgorithm, COLORS.resetColor, "\n");
                        model.log = model.log.concat(COLORS.yellow, "[+] : CCOperation: ", value.CCOperation, COLORS.resetColor, "\n");
                        model.log = model.log.concat(COLORS.yellow, "[+] : CCMode: ", value.CCMode, COLORS.resetColor, "\n");
                        model.log = model.log.concat(COLORS.yellow, "[+] : CCKeySize: ", value.CCKeySize, COLORS.resetColor, "\n");
                        model.log = model.log.concat(COLORS.yellow, "[+] : CCModeOptions: ", value.CCModeOptions, COLORS.resetColor, "\n");
                        model.log = model.log.concat(COLORS.yellow, "[+] : CCPadding: ", value.CCPadding, COLORS.resetColor, "\n");
                        model.log = model.log.concat(COLORS.yellow, "[+] : Key: ", value.Key, COLORS.resetColor, "\n");
                        model.log = model.log.concat(COLORS.yellow, "[+] : Iv: ", value.Iv, COLORS.resetColor, "\n");
                        if (parseInt(value.TweakLen) > 0) {
                            model.log = model.log.concat(COLORS.yellow, "[+] : TweakLen: ", value.TweakLen, COLORS.resetColor, "\n");
                            model.log = model.log.concat(COLORS.yellow, "[+] : Tweak: ", value.Tweak, COLORS.resetColor, "\n");
                        }
                        model.log = model.log.concat(COLORS.yellow, "[+] : NumRounds: ", value.NumRounds, COLORS.resetColor, "\n");
                    }
                }
                model.log = model.log.concat(COLORS.blue, "[=] End of list", COLORS.resetColor, "\n");
                cRefCache[pointerToInt(this.params[0])] = model;
            }
            if (!model.enable)
                return;
            model.originalLen += this.params[2].toInt32();
            let remainingSpace = CIPHER_CONFIG.crypto.maxDataLength - model.totalLen;
            let dataLen = pointerToInt(this.params[2]);
            if (dataLen > 0 && remainingSpace > 0) {
                let copyLength = Math.min(dataLen, remainingSpace);
                let tmpData = Memory.alloc(copyLength);
                Memory.copy(tmpData, this.params[1], copyLength);
                model.dataMap.push({ data: tmpData, len: copyLength });
                model.totalLen += copyLength;
            }
            let outRemainingSpace = CIPHER_CONFIG.crypto.maxDataLength - model.totalOutLen;
            let outLen = pointerToInt(this.params[5].readPointer());
            model.originalOutLen += outLen;
            if (outLen > 0 && outRemainingSpace > 0) {
                let copyLength = Math.min(outLen, outRemainingSpace);
                let tmpDataOut = Memory.alloc(copyLength);
                Memory.copy(tmpDataOut, this.params[3], copyLength);
                model.dataOutMap.push({ data: tmpDataOut, len: copyLength });
                model.totalOutLen += copyLength;
            }
        }
    });
    //CCCryptorStatus CCCryptorFinal(CCCryptorRef cryptorRef, void *dataOut,size_t dataOutAvailable, size_t *dataOutMoved);
    let CCCryptorFinal = Module.findExportByName("libSystem.B.dylib", "CCCryptorFinal");
    if (CCCryptorFinal == null) {
        console.error("CCCryptorFinal func is null");
        return;
    }
    Interceptor.attach(CCCryptorFinal, {
        onEnter: function (args) {
            this.params = [];
            for (let i = 0; i < 4; i++) {
                this.params.push(args[i]);
            }
        },
        onLeave: function (retval) {
            let model = cRefCache[pointerToInt(this.params[0])];
            if (model == null) {
                console.error("CCCryptorFinal model is null");
                return;
            }
            if (!model.enable)
                return;
            if (model.totalOutLen < CIPHER_CONFIG.crypto.maxDataLength) {
                let outRemainingSpace = CIPHER_CONFIG.crypto.maxDataLength - model.totalOutLen;
                let outLen = pointerToInt(this.params[3].readPointer());
                model.originalOutLen += outLen;
                if (outLen > 0 && outRemainingSpace > 0) {
                    let copyLength = Math.min(outLen, outRemainingSpace);
                    let tmpDataOut = Memory.alloc(copyLength);
                    Memory.copy(tmpDataOut, this.params[1], copyLength);
                    model.dataOutMap.push({ data: tmpDataOut, len: copyLength });
                    model.totalOutLen += copyLength;
                }
            }
            let totalData = Memory.alloc(model.totalLen);
            var offset = 0;
            model.dataMap.forEach(function (value) {
                Memory.copy(totalData.add(offset), value.data, value.len);
                offset += value.len;
            });
            let totalOutData = Memory.alloc(model.totalOutLen);
            var offsetOut = 0;
            model.dataOutMap.forEach(function (value) {
                Memory.copy(totalOutData.add(offsetOut), value.data, value.len);
                offsetOut += value.len;
            });
            model.log = model.log.concat("[+] Data len: " + model.totalLen + "/" + model.originalLen + "\n");
            model.log = model.log.concat("[+] Data : \n", print_arg(totalData, model.totalLen), "\n");
            model.log = model.log.concat(COLORS.magenta, "[+] Data out len: " + model.totalOutLen + "/" + model.originalOutLen + "\n");
            model.log = model.log.concat("[+] Data out: \n", print_arg(totalOutData, model.totalOutLen), "\n", COLORS.resetColor);
            if (CIPHER_CONFIG.crypto.printStack) {
                model.log = model.log.concat(COLORS.blue, "[+] stack:\n", Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join("\n"), COLORS.resetColor, "\n");
            }
            model.log = model.log.concat(COLORS.green, "[*] EXIT CCCryptorFinal ", COLORS.resetColor, "\n");
            model.finish = true;
            filterLog(model.log, CIPHER_CONFIG.crypto.filter);
        }
    });
}
function commonHashInterceptor(name, length) {
    let hash = Module.findExportByName("libSystem.B.dylib", name);
    if (hash == null) {
        console.error(name + " func is null");
        return;
    }
    Interceptor.attach(hash, {
        onEnter: function (args) {
            this.log = "";
            this.log = this.log.concat(COLORS.green, "[*] ENTER ", name, COLORS.resetColor, "\n");
            let dataLen = args[1].toInt32();
            let printLen = Math.min(dataLen, CIPHER_CONFIG.hash.maxInputDataLength);
            this.log = this.log.concat("[+] Data len: ", printLen, "/", dataLen, "\n");
            this.log = this.log.concat("[+] Data: \n", print_arg(args[0], printLen), "\n");
        },
        onLeave: function (reval) {
            this.log = this.log.concat(COLORS.magenta, "[+] Data out len: " + length, COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.magenta, "[+] Data out:\n", print_arg(reval, length), COLORS.resetColor, "\n");
            if (CIPHER_CONFIG.hash.printStack) {
                this.log = this.log.concat(COLORS.blue, "[+] stack:\n", Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join("\n"), COLORS.resetColor, "\n");
            }
            this.log = this.log.concat(COLORS.green, "[*] EXIT ", name, COLORS.resetColor, "\n");
            filterLog(this.log, CIPHER_CONFIG.hash.filter);
        }
    });
    (function () {
        let ctxCache = {};
        //CC_SHA1_Init(CC_SHA1_CTX *c);
        let init = Module.findExportByName("libSystem.B.dylib", name + "_Init");
        if (init == null) {
            console.error(name + "_Init func is null");
            return;
        }
        Interceptor.attach(init, {
            onEnter: function (args) {
                let model = { ctx: args[0], dataMap: [], totalLen: 0, originalLen: 0, log: "" };
                ctxCache[pointerToInt(args[0])] = model;
                model.log = model.log.concat(COLORS.green, "[*] ENTER " + name + "_Init\n", COLORS.resetColor);
            }
        });
        //CC_SHA1_Update(CC_SHA1_CTX *c, const void *data, CC_LONG len);
        let update = Module.findExportByName("libSystem.B.dylib", name + "_Update");
        if (update == null) {
            console.error(name + "_Update func is null");
            return;
        }
        Interceptor.attach(update, {
            onEnter: function (args) {
                let model = ctxCache[pointerToInt(args[0])];
                if (model == null) {
                    console.error("model is null");
                    return;
                }
                let len = pointerToInt(args[2]);
                let remainingSpace = CIPHER_CONFIG.hash.maxInputDataLength - model.totalLen;
                if (len > 0 && remainingSpace > 0) {
                    model.originalLen += len;
                    let copyLen = Math.min(len, remainingSpace);
                    let tmpData = Memory.alloc(copyLen);
                    Memory.copy(tmpData, args[1], copyLen);
                    model.dataMap.push({ data: tmpData, len: copyLen });
                    model.totalLen += copyLen;
                }
            }
        });
        //CC_SHA1_Final(unsigned char *md, CC_SHA1_CTX *c);
        let final = Module.findExportByName("libSystem.B.dylib", name + "_Final");
        if (final == null) {
            console.error(name + "_Final func is null");
            return;
        }
        Interceptor.attach(final, {
            onEnter: function (args) {
                this.mdSha = args[0];
                this.ctxSha = args[1];
            },
            onLeave: function (retval) {
                let model = ctxCache[pointerToInt(this.ctxSha)];
                if (model == null) {
                    console.error(name + "_Final model is null");
                    return;
                }
                if (model.totalLen <= 0) {
                    console.error("totalLen :", model.totalLen);
                    return;
                }
                let totalData = Memory.alloc(model.totalLen);
                var offset = 0;
                model.dataMap.forEach(function (value) {
                    Memory.copy(totalData.add(offset), value.data, value.len);
                    offset += value.len;
                });
                model.log = model.log.concat("[+] Data len: " + model.totalLen + "/" + model.originalLen + "\n");
                model.log = model.log.concat("[+] Data :\n");
                model.log = model.log.concat(print_arg(totalData, model.totalLen), "\n");
                if (pointerToInt(this.mdSha) !== 0) {
                    model.log = model.log.concat(COLORS.magenta, "[+] Data out len: " + length + "\n");
                    model.log = model.log.concat("[+] Data out:\n");
                    model.log = model.log.concat(print_arg(ptr(this.mdSha), length), "\n", COLORS.resetColor);
                }
                else {
                    model.log = model.log.concat(COLORS.red, "[!]: Data out: null\n", COLORS.resetColor);
                }
                if (CIPHER_CONFIG.hash.printStack) {
                    model.log = model.log.concat(COLORS.blue, "[+] stack:\n", Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join("\n"), COLORS.resetColor, "\n");
                }
                model.log = model.log.concat(COLORS.green, "[*] EXIT " + name + "_Final" + "\n", COLORS.resetColor);
                filterLog(model.log, CIPHER_CONFIG.hash.filter);
            }
        });
    })();
}
function commonHMACInterceptor() {
    function checkHMACAlgorithmEnable(algorithm) {
        switch (algorithm) {
            case 0:
                return CIPHER_CONFIG.hmac.sha1;
            case 1:
                return CIPHER_CONFIG.hmac.md5;
            case 2:
                return CIPHER_CONFIG.hmac.sha256;
            case 3:
                return CIPHER_CONFIG.hmac.sha384;
            case 4:
                return CIPHER_CONFIG.hmac.sha512;
            case 5:
                return CIPHER_CONFIG.hmac.sha224;
            default:
                return true;
        }
    }
    let name = "CCHmac";
    //void CCHmac(CCHmacAlgorithm algorithm, const void *key, size_t keyLength,const void *data, size_t dataLength, void *macOut);
    let hmac = Module.findExportByName("libSystem.B.dylib", name);
    if (hmac == null) {
        console.error(name + " func is null");
        return;
    }
    Interceptor.attach(hmac, {
        onEnter: function (args) {
            this.enable = checkHMACAlgorithmEnable(args[0].toInt32());
            if (!this.enable)
                return;
            this.mdLen = CCHmacAlgorithmLength[args[0].toInt32()];
            this.log = "";
            this.log = this.log.concat(COLORS.green, "[*] ENTER ", name, "\n");
            this.log = this.log.concat(COLORS.yellow, "[+] Algorithm: ", CCHmacAlgorithm[args[0].toInt32()], "\n", COLORS.resetColor);
            this.log = this.log.concat(COLORS.cyan, "[+] Key len: ", args[2].toInt32(), "\n");
            this.log = this.log.concat(COLORS.cyan, "[+] Key : \n", print_arg(args[1], args[2].toInt32()), "\n", COLORS.resetColor);
            let dataLen = args[4].toInt32();
            let printLen = Math.min(dataLen, CIPHER_CONFIG.hmac.maxInputDataLength);
            this.log = this.log.concat("[+] Data len: ", printLen, "/", dataLen, "\n");
            this.log = this.log.concat("[+] Data: \n", print_arg(args[3], printLen), "\n");
            this.macOut = args[5];
        },
        onLeave: function (reval) {
            if (!this.enable)
                return;
            this.log = this.log.concat(COLORS.magenta, "[+] Data out len: " + this.mdLen, COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.magenta, "[+] Data out:\n", print_arg(this.macOut, this.mdLen), COLORS.resetColor, "\n");
            if (CIPHER_CONFIG.hmac.printStack) {
                this.log = this.log.concat(COLORS.blue, "[+] stack:\n", Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join("\n"), COLORS.resetColor, "\n");
            }
            this.log = this.log.concat(COLORS.green, "[*] EXIT ", name, COLORS.resetColor, "\n");
            filterLog(this.log, CIPHER_CONFIG.hmac.filter);
        }
    });
    (function () {
        let ctxCache = {};
        //void
        //      CCHmacInit(CCHmacContext *ctx, CCHmacAlgorithm algorithm,
        //          const void *key, size_t keyLength);
        let init = Module.findExportByName("libSystem.B.dylib", name + "Init");
        if (init == null) {
            console.error(name + "Init func is null");
            return;
        }
        Interceptor.attach(init, {
            onEnter: function (args) {
                let model = { ctx: args[0], dataMap: [], totalLen: 0, originalLen: 0, log: "", mdLen: CCHmacAlgorithmLength[args[1].toInt32()], enable: checkHMACAlgorithmEnable(args[1].toInt32()) };
                ctxCache[pointerToInt(args[0])] = model;
                if (!model.enable)
                    return;
                model.log = model.log.concat(COLORS.green, "[*] ENTER " + name + "Init\n", COLORS.resetColor);
                model.log = model.log.concat(COLORS.yellow, "[+] Algorithm: " + CCHmacAlgorithm[args[1].toInt32()] + "\n", COLORS.resetColor);
                model.log = model.log.concat(COLORS.cyan, "[+] Key len: " + args[3].toInt32() + COLORS.resetColor + "\n");
                model.log = model.log.concat(COLORS.cyan, "[+] Key: \n" + print_arg(args[2], pointerToInt(args[3])) + "\n", COLORS.resetColor);
            }
        });
        //void
        //      CCHmacUpdate(CCHmacContext *ctx, const void *data, size_t dataLength);
        let update = Module.findExportByName("libSystem.B.dylib", name + "Update");
        if (update == null) {
            console.error(name + "Update func is null");
            return;
        }
        Interceptor.attach(update, {
            onEnter: function (args) {
                let model = ctxCache[pointerToInt(args[0])];
                if (model == null) {
                    console.error(name + "Update model is null");
                    return;
                }
                if (!model.enable)
                    return;
                let len = pointerToInt(args[2]);
                let remainingSpace = CIPHER_CONFIG.hmac.maxInputDataLength - model.totalLen;
                if (len > 0 && remainingSpace > 0) {
                    model.originalLen += len;
                    let copyLen = Math.min(len, remainingSpace);
                    let tmpData = Memory.alloc(copyLen);
                    Memory.copy(tmpData, args[1], copyLen);
                    model.dataMap.push({ data: tmpData, len: copyLen });
                    model.totalLen += copyLen;
                }
            }
        });
        //void
        //      CCHmacFinal(CCHmacContext *ctx, void *macOut);
        let final = Module.findExportByName("libSystem.B.dylib", name + "Final");
        if (final == null) {
            console.error(name + "Final func is null");
            return;
        }
        Interceptor.attach(final, {
            onEnter: function (args) {
                this.mdOut = args[1];
                this.ctx = args[0];
            },
            onLeave: function (retval) {
                let model = ctxCache[pointerToInt(this.ctx)];
                if (model == null) {
                    console.error(name + "Final model is null");
                    return;
                }
                if (!model.enable)
                    return;
                if (model.totalLen <= 0) {
                    console.error("totalLen :", model.totalLen);
                    return;
                }
                let totalData = Memory.alloc(model.totalLen);
                var offset = 0;
                model.dataMap.forEach(function (value) {
                    Memory.copy(totalData.add(offset), value.data, value.len);
                    offset += value.len;
                });
                model.log = model.log.concat("[+] Data len: " + model.totalLen + "/" + model.originalLen + "\n");
                model.log = model.log.concat("[+] Data :\n");
                model.log = model.log.concat(print_arg(totalData, model.totalLen), "\n");
                model.log = model.log.concat(COLORS.magenta, "[+] Data out len: " + model.mdLen + "\n");
                model.log = model.log.concat("[+] Data out:\n");
                model.log = model.log.concat(print_arg(ptr(this.mdOut), model.mdLen), "\n", COLORS.resetColor);
                if (CIPHER_CONFIG.hmac.printStack) {
                    model.log = model.log.concat(COLORS.blue, "[+] stack:\n", Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join("\n"), COLORS.resetColor, "\n");
                }
                model.log = model.log.concat(COLORS.green, "[*] EXIT " + name + "Final" + "\n", COLORS.resetColor);
                filterLog(model.log, CIPHER_CONFIG.hmac.filter);
            }
        });
    })();
}
//pbkdf
function commonPBKDFInterceptor() {
    //int
    // CCKeyDerivationPBKDF( CCPBKDFAlgorithm algorithm, const char *password, size_t passwordLen,
    //                       const uint8_t *salt, size_t saltLen,
    //                       CCPseudoRandomAlgorithm prf, uint rounds,
    //                       uint8_t *derivedKey, size_t derivedKeyLen)
    let CCKeyDerivationPBKDF = Module.findExportByName("libSystem.B.dylib", "CCKeyDerivationPBKDF");
    if (CCKeyDerivationPBKDF == null) {
        console.error("CCKeyDerivationPBKDF func is null");
        return;
    }
    Interceptor.attach(CCKeyDerivationPBKDF, {
        onEnter: function (args) {
            this.params = [];
            for (let i = 0; i < 9; i++) {
                this.params.push(args[i]);
            }
        },
        onLeave: function (reval) {
            var log = "";
            log = log.concat(COLORS.green, "[*] ENTER CCKeyDerivationPBKDF", COLORS.resetColor, "\n");
            log = log.concat(COLORS.yellow, "[+] Algorithm: ", CCPBKDFAlgorithm[this.params[0].toInt32()], "\n", COLORS.resetColor);
            log = log.concat(COLORS.yellow, "[+] PseudoRandomAlgorithm: ", CCPseudoRandomAlgorithm[this.params[5].toInt32()], "\n", COLORS.resetColor);
            log = log.concat(COLORS.cyan, "[+] Rounds: ", String(pointerToInt(this.params[6])), "\n", COLORS.resetColor);
            log = log.concat(COLORS.cyan, "[+] Password len: ", this.params[2].toInt32(), "\n");
            log = log.concat(COLORS.cyan, "[+] Password : \n", print_arg(this.params[1], this.params[2].toInt32()), "\n", COLORS.resetColor);
            log = log.concat(COLORS.cyan, "[+] Salt len: ", this.params[4].toInt32(), "\n");
            log = log.concat(COLORS.cyan, "[+] Salt : \n", print_arg(this.params[3], this.params[4].toInt32()), "\n", COLORS.resetColor);
            log = log.concat(COLORS.cyan, "[+] DerivedKey len: ", this.params[8].toInt32(), "\n");
            log = log.concat(COLORS.cyan, "[+] DerivedKey : \n", print_arg(this.params[7], this.params[8].toInt32()), "\n", COLORS.resetColor);
            if (CIPHER_CONFIG.pbkdf.printStack) {
                log = log.concat(COLORS.blue, "[+] stack:\n", Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join("\n"), COLORS.resetColor, "\n");
            }
            log = log.concat(COLORS.green, "[*] EXIT CCKeyDerivationPBKDF", COLORS.resetColor, "\n");
            filterLog(log, CIPHER_CONFIG.pbkdf.filter);
        }
    });
    //uint
    // CCCalibratePBKDF(CCPBKDFAlgorithm algorithm, size_t passwordLen, size_t saltLen,
    //                  CCPseudoRandomAlgorithm prf, size_t derivedKeyLen, uint32_t msec)
    let CCCalibratePBKDF = Module.findExportByName("libSystem.B.dylib", "CCCalibratePBKDF");
    if (CCCalibratePBKDF == null) {
        console.error("CCCalibratePBKDF func is null");
        return;
    }
    Interceptor.attach(CCCalibratePBKDF, {
        onEnter: function (args) {
            this.log = "";
            this.log = this.log.concat(COLORS.green, "[*] ENTER CCCalibratePBKDF", COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.yellow, "[+] Algorithm: ", CCPBKDFAlgorithm[args[0].toInt32()], "\n", COLORS.resetColor);
            this.log = this.log.concat(COLORS.yellow, "[+] PseudoRandomAlgorithm: ", CCPseudoRandomAlgorithm[args[3].toInt32()], "\n", COLORS.resetColor);
            this.log = this.log.concat(COLORS.cyan, "[+] Password len: ", args[1].toInt32(), COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.cyan, "[+] Salt len: ", args[2].toInt32(), COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.cyan, "[+] DerivedKey len: ", args[4].toInt32(), COLORS.resetColor, "\n");
            this.log = this.log.concat(COLORS.cyan, "[+] Msec : ", pointerToInt(args[5]), COLORS.resetColor, "\n");
        },
        onLeave: function (reval) {
            this.log = this.log.concat(COLORS.cyan, "[+] IterNum : \n", pointerToInt(reval), COLORS.resetColor, "\n");
            if (CIPHER_CONFIG.pbkdf.printStack) {
                this.log = this.log.concat(COLORS.blue, "[+] stack:\n", Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join("\n"), COLORS.resetColor, "\n");
            }
            this.log = this.log.concat(COLORS.green, "[*] EXIT CCCalibratePBKDF", COLORS.resetColor, "\n");
            filterLog(this.log, CIPHER_CONFIG.pbkdf.filter);
        }
    });
}
//start
(function () {
    if (!CIPHER_CONFIG.enable) {
        return;
    }
    if (CIPHER_CONFIG.crypto.enable) {
        commonCryptoInterceptor();
    }
    if (CIPHER_CONFIG.hash.enable) {
        if (CIPHER_CONFIG.hash.sha1) {
            //extern unsigned char *CC_SHA1(const void *data, CC_LONG len, unsigned char *md)
            commonHashInterceptor("CC_SHA1", 20);
        }
        if (CIPHER_CONFIG.hash.sha224) {
            //extern unsigned char *CC_SHA224(const void *data, CC_LONG len, unsigned char *md);
            commonHashInterceptor("CC_SHA224", 28);
        }
        if (CIPHER_CONFIG.hash.sha256) {
            //extern unsigned char *CC_SHA256(const void *data, CC_LONG len, unsigned char *md);
            commonHashInterceptor("CC_SHA256", 32);
        }
        if (CIPHER_CONFIG.hash.sha384) {
            //extern unsigned char *CC_SHA384(const void *data, CC_LONG len, unsigned char *md);
            commonHashInterceptor("CC_SHA384", 48);
        }
        if (CIPHER_CONFIG.hash.sha512) {
            //extern unsigned char *CC_SHA512(const void *data, CC_LONG len, unsigned char *md);
            commonHashInterceptor("CC_SHA512", 64);
        }
        if (CIPHER_CONFIG.hash.md2) {
            //extern unsigned char *CC_MD2(const void *data, CC_LONG len, unsigned char *md);
            commonHashInterceptor("CC_MD2", 16);
        }
        if (CIPHER_CONFIG.hash.md4) {
            //extern unsigned char *CC_MD4(const void *data, CC_LONG len, unsigned char *md);
            commonHashInterceptor("CC_MD4", 16);
        }
        if (CIPHER_CONFIG.hash.md5) {
            //extern unsigned char *CC_MD5(const void *data, CC_LONG len, unsigned char *md);
            commonHashInterceptor("CC_MD5", 16);
        }
        if (CIPHER_CONFIG.hmac.enable) {
            commonHMACInterceptor();
        }
        if (CIPHER_CONFIG.pbkdf.enable) {
            commonPBKDFInterceptor();
        }
    }
})();
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/foundation/include.ts"],"names":[],"mappings":"AAAA,OAAO,YAAY,CAAA;AACnB,OAAO,eAAe,CAAA"}
✄
import './nslog.js';
import './nsbundle.js';
✄
{"version":3,"file":"nsbundle.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/foundation/nsbundle.ts"],"names":[],"mappings":"AAEA,yEAAyE;AACzE,MAAM,oBAAoB,GAAG,GAAE,EAAE;IAC7B,OAAO,IAAI,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,kBAAkB,CAAC,EAAE,CAAC,QAAQ,EAAE,CAAA;AACpF,CAAC,CAAA;AAMD,UAAU,CAAC,oBAAoB,GAAG,oBAAoB,CAAA"}
✄
// NSString *bundleIdentifier = [[NSBundle mainBundle] bundleIdentifier];
const get_BundleIdentifier = () => {
    return ObjC.classes["NSBundle"]["mainBundle"]()["bundleIdentifier"]().toString();
};
globalThis.get_BundleIdentifier = get_BundleIdentifier;
export {};
✄
{"version":3,"file":"nslog.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/foundation/nslog.ts"],"names":[],"mappings":"AAEA,MAAM,OAAO,GAAG,GAAG,EAAE;IACjB,MAAM,OAAO,GAAG,MAAM,CAAC,gBAAgB,CAAC,YAAY,EAAE,OAAO,CAAC,CAAA;IAC9D,IAAI,CAAC,OAAO;QAAE,OAAO,IAAI,CAAC,0BAA0B,CAAC,CAAA;IAErD,WAAW,CAAC,MAAM,CAAC,OAAQ,EAAE;QACzB,OAAO,CAAC,IAAI;YACR,MAAM,GAAG,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAA,CAAC,WAAW;YAC3D,MAAM,UAAU,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,GAAG,CAAC,CAAA;YAC5C,IAAI,QAAQ,GAAG,EAAE,CAAA;YACjB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,GAAC,CAAC,EAAE,CAAC,EAAE,EAAE;gBACnC,QAAQ,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAA;gBAC9B,QAAQ,IAAI,IAAI,CAAA;aACnB;YACD,IAAI,CAAC,UAAU,GAAG,MAAM,QAAQ,EAAE,CAAC,CAAA;QACvC,CAAC;KACJ,CAAC,CAAA;AACN,CAAC,CAAA;AAMD,UAAU,CAAC,OAAO,GAAG,OAAO,CAAA"}
✄
const B_NSLOG = () => {
    const address = Module.findExportByName("Foundation", "NSLog");
    if (!address)
        return loge("NSLog address not found!");
    Interceptor.attach(address, {
        onEnter(args) {
            const fmt = new ObjC.Object(args[0]).toString(); // NSString
            const count_args = fmt.split("%").length - 1;
            let args_str = '';
            for (let i = 1; i < count_args + 1; i++) {
                args_str += args[i].toString();
                args_str += ', ';
            }
            logd(`NSLog: ${fmt} | ${args_str}`);
        }
    });
};
globalThis.B_NSLOG = B_NSLOG;
export {};
✄
{"version":3,"file":"dyld.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/hooks/dyld.ts"],"names":[],"mappings":"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"}
✄
globalThis.hook_dyld_log = () => {
    // dyld::log(char const*, ...)
    // logd(`getSym("dyld::log","dyld") = ${getSym("dyld::log", "dyld")![0].address}`)
    A(getSym("dyld::log", "dyld")[0].address, (args) => {
        logd(`dyld::log ${args[0].readCString()}`);
    });
};
globalThis.hook_dyld_get_image_name = () => {
    logw(`MAIN Process ${Process.id}`);
    // _dyld_image_count
    A(getSym("_dyld_image_count", "dyld")[0].address, undefined, (ret, ctx) => {
        logd(`[ ${Process.getCurrentThreadId()} ] \tcalled _dyld_image_count -> ${ret.toInt32()}`);
        logz(`called from:\n${Thread.backtrace(ctx, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join('\t\n')}\n`);
    });
    Interceptor.attach(getSym("_dyld_get_image_name", "dyld")[0].address, {
        onEnter(args) {
            this.msg = `_dyld_get_image_name( ${args[0]} | ${args[0].toInt32()} )`;
            this.index = args[0].toInt32();
        },
        onLeave(retval) {
            let mm = (`${retval} = ${this.msg}\t<-\t${retval.readCString()}`);
            let mm1 = mm.toLowerCase();
            if (this.index == 0 || mm1.includes("libsubstrate") || mm.includes("CepheiUI") || mm1.includes("substrate")
                || mm1.includes("substitute-loader.dylib") || mm1.includes("libsubstitute.0.dylib") || mm1.includes("libsubstrate.dylib")
                || mm1.includes("FridaAgent") || mm1.includes("FlyJB2.dylib") || mm1.includes("HideJB.dylib")
                || mm1.includes("Cephei") || mm1.includes("CepheiUI") || mm1.includes("zzzzzzzzzNotifyChroot.dylib")
                || mm1.includes("zzzzLiberty.dylib") || mm1.includes("Cephei") || mm1.includes("Cephei")) {
                const newStr = Memory.allocUtf8String(retval.readCString().replace("substrate", "sub").replace("stitute", "sub"));
                retval.replace(newStr);
                logw(mm + " | modify to " + retval.readCString());
                logz(`called from:\n${Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join('\n\t')}\n`);
            }
            else {
                logd(mm);
            }
        }
    });
};
// hook __mod_init_funcs
globalThis.hook_dyld_mod_init_funcs = (offset) => {
    // src/ImageLoaderMachO.cpp
    // void ImageLoaderMachO::doModInitFunctions(const LinkContext& context)
    // func(context.argc, context.argv, context.envp, context.apple, &context.programVars);
    function findOffset() {
        const addr = getSym("ImageLoaderMachO::doModInitFunctions", "dyld")[0].address;
        let maxInsItor = 200;
        let current = Instruction.parse(addr);
        let md = Process.findModuleByName("dyld");
        const addr_helper = getSym("_ZN4dyld17gLibSystemHelpersE", "dyld")[0].address;
        while (--maxInsItor > 0) {
            // logw(`${current.address} ${current.address.sub(md?.base!)} ${current}`)
            if (current.mnemonic == "blr") {
                // loge(`${current.address} ${current.address.sub(md?.base!)} ${current}`)
                // check
                // 0x1042bf2c0 0x172c0 blr x24
                // 0x1042bf2c4 0x172c4 cbnz x22, #0x1042bf2ec
                // 0x1042bf2c8 0x172c8 adrp x8, #0x104314000
                // 0x1042bf2cc 0x172cc add x8, x8, #0x3c8
                const next_1 = Instruction.parse(current.next);
                const next_2 = Instruction.parse(next_1.next);
                const next_3 = Instruction.parse(next_2.next);
                if (next_2.mnemonic == "adrp" && next_3.mnemonic == "add") {
                    const v_2 = Number(next_2.operands.filter(i => i.type == "imm")[0].value);
                    const v_3 = Number(next_3.operands.filter(i => i.type == "imm")[0].value);
                    if (addr_helper.equals(v_2 + v_3))
                        return current.address;
                }
            }
            current = Instruction.parse(current.next);
        }
        return NULL;
    }
    const nopCall = new NativeCallback(() => {
        logd("nop call 'KSAdSDK!registerDyldCallback'");
    }, "void", []);
    A(offset != undefined ? offset : findOffset(), (_args, ctx) => {
        const x24L = ctx.x24;
        const debuginfo = DebugSymbol.fromAddress(x24L).toString();
        logd(`call init -> ${x24L} | ${debuginfo}`);
        // {
        //     let ins = Instruction.parse(x24L)
        //     for (let i = 0; i < 500; i++) {
        //         if (i == 0 || i == 499) logw(ins)
        //         if (ins.toString().includes('svc')) loge(`Found SVC ${ins.address} ${ins}`)
        //         ins = Instruction.parse(ins.next)
        //     }
        // }
        // if (debuginfo.includes("KSAdSDK!registerDyldCallback")) {
        //     (ctx as Arm64CpuContext).x24 = nopCall
        // }
        // A(x24L, (args)=>{logz(`Enter ${x24L}`)}, (ret)=>{logz(`Leave ${x24L}`)})
        // if(!debuginfo.includes("UnityFramework")) return
        // Interceptor.attach(x24L, {
        //     onEnter(args) {
        //         logz(`Enter ${x24L}`)
        //         Stalker.follow(Process.getCurrentThreadId(), {
        //             events: {
        //                 call: false,
        //                 // ret: false,
        //                 // exec: true,
        //                 // block: false,
        //                 // compile: false,
        //             },
        //             transform: function (iterator: StalkerArm64Iterator | StalkerArmIterator) {
        //                 let instruction = iterator.next()!
        //                 do {
        //                     let msg = `${DebugSymbol.fromAddress(instruction?.address as NativePointer)} ${instruction}`
        //                     if (instruction.toString().includes("svc")) {
        //                         loge(`${msg}`)
        //                         sleep(3)
        //                     } else {
        //                         logz(`${msg}`)
        //                     }
        //                     iterator.keep()
        //                 } while ((instruction = iterator.next()!) !== null)
        //             }
        //         })
        //     },
        //     onLeave(retval) {
        //         logz(`Leave ${x24L}`)
        //         Stalker.unfollow(Process.getCurrentThreadId())
        //     }
        // })
        // if (debuginfo.includes("UnityFramework") || debuginfo.includes("UnityFramework!0x12") || debuginfo.includes("UnityFramework!0xfc")) {
        // Stalker.follow(Process.getCurrentThreadId(), {
        //     events: {
        //         compile: true
        //     },
        //     onReceive: function (events) {
        //         const bbs = Stalker.parse(events, {
        //             stringify: false,
        //             annotate: false
        //         });
        //         logd("↓ Stalker trace ↓\n")
        //         logd(bbs.flat().map(item => DebugSymbol.fromAddress(ptr(item as unknown as string))).join('\n'));
        //     }
        // })
    });
};
globalThis.hook_dyld_doModInitFunctions = () => {
    // void ImageLoaderMachO::doModInitFunctions(const LinkContext& context)
    A(getSym("doModInitFunctions", "dyld")[0].address, (args) => {
        logd(`Enter doModInitFunctions ImageLoaderMachO:${args[0]} LinkContext&:${args[1]}`);
        // hex(args[1])
    }, () => {
        logd(`Exit doModInitFunctions\n`);
    });
};
globalThis.hook_dyld_ImageLoader_findExportedSymbol = () => {
    // const ImageLoader::Symbol* ImageLoaderMachO::findExportedSymbol(const char* name, bool searchReExports, const char* thisPath, const ImageLoader** foundIn) const
    A(getSym("ImageLoaderMachO::findExportedSymbol", "dyld")[0].address, (args, _ctx, pv) => {
        pv.set('pv', `ImageLoaderMachO::findExportedSymbol( INS:${args[0]}, name=${args[1].readCString()}, searchReExports=${args[2]}, thisPath=${args[3].readCString()}, foundIn=${args[4]} )`);
    }, (retval, _ctx, pv) => {
        logd(`Sym*:${retval} = ${pv.get('pv')}`);
    });
};
globalThis.hook_dyld_ImageLoader_recursiveInitialization = () => {
    // 0x104401ed8 => ImageLoader::recursiveInitialization(ImageLoader::LinkContext const&, unsigned int, char const*, ImageLoader::InitializerTimingList&, ImageLoader::UninitedUpwards&)
    // void recursiveInitialization(const LinkContext& context, mach_port_t this_thread, const char* pathToInitialize, ImageLoader::InitializerTimingList&, ImageLoader::UninitedUpwards&);
    A(getSym("ImageLoader::recursiveInitialization", "dyld")[0].address, (args) => {
        logd(`called ImageLoader::recursiveInitialization( ImageLoader:${args[0]}, context:${args[1]}, this_thread:${args[2].toInt32()}`);
    });
};
globalThis.dyld_register_func = (func) => {
    // struct mach_header {
    //     uint32_t    magic;        /* mach magic number identifier */
    //     int32_t        cputype;    /* cpu specifier */
    //     int32_t        cpusubtype;    /* machine specifier */
    //     uint32_t    filetype;    /* type of file */
    //     uint32_t    ncmds;        /* number of load commands */
    //     uint32_t    sizeofcmds;    /* the size of all the load commands */
    //     uint32_t    flags;        /* flags */
    // };
    // const struct mach_header *header, intptr_t slide
    const addr_dyld_register_func = DebugSymbol.fromName("_dyld_register_func_for_add_image").address;
    const func_dyld_register_func = new NativeFunction(addr_dyld_register_func, "pointer", ['pointer']);
    func_dyld_register_func(new NativeCallback(function (header, slide) {
        logd(`_dyld_register_func_for_add_image ${header} ${slide}`);
        func(header, slide);
        return NULL;
    }, "pointer", ["pointer", "pointer"]));
};
export {};
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/hooks/include.ts"],"names":[],"mappings":"AAAA,OAAO,WAAW,CAAA;AAClB,OAAO,cAAc,CAAA"}
✄
import './dyld.js';
import './libdyld.js';
✄
{"version":3,"file":"libdyld.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/hooks/libdyld.ts"],"names":[],"mappings":"AAAA,UAAU,CAAC,WAAW,GAAG,CAAC,MAA2B,EAAE,iBAAuB,KAAK,EAAE,EAAE;IACnF,gDAAgD;IAChD,CAAC,CAAC,WAAW,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,OAAO,EAAE,CAAC,IAAI,EAAC,GAAG,EAAC,EAAE,EAAC,EAAE;QACrD,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC,MAAM,EAAE;YAAE,OAAM;QACxB,MAAM,IAAI,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,CAAA;QAClC,EAAE,CAAC,GAAG,CAAC,KAAK,EAAE,YAAY,IAAI,CAAC,CAAC,CAAC,IAAI,IAAI,KAAK,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,CAAA;QAC1D,IAAI,cAAc;YAAE,IAAI,CAAC,uBAAuB,GAAG,MAAM,CAAC,SAAS,CAAC,GAAG,EAAE,UAAU,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,CAAA;IACjJ,CAAC,EAAC,CAAC,MAAM,EAAE,IAAI,EAAE,EAAE,EAAC,EAAE;QAClB,IAAI,CAAC,GAAG,MAAM,MAAM,EAAE,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA;IACxC,CAAC,CACJ,CAAA;AACL,CAAC,CAAA"}
✄
globalThis.hook_dlopen = (onCall, printBackTrace = false) => {
    // void* dlopen(const char* filename, int flag);
    A(DebugSymbol.fromName("dlopen").address, (args, ctx, pv) => {
        if (args[0].isNull())
            return;
        const name = args[0].readCString();
        pv.set("msg", `dlopen ( ${args[0]} ${name}, ${args[1]} )`);
        if (printBackTrace)
            logw('dlopen called from:\n' + Thread.backtrace(ctx, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join('\n') + '\n');
    }, (retval, _ctx, pv) => {
        logd(`${retval} = ${pv.get("msg")}`);
    });
};
export {};
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/include.ts"],"names":[],"mappings":"AAAA,OAAO,oBAAoB,CAAA;AAE3B,OAAO,yBAAyB,CAAA;AAChC,OAAO,wBAAwB,CAAA;AAC/B,OAAO,sBAAsB,CAAA;AAC7B,OAAO,sBAAsB,CAAA;AAC7B,OAAO,mBAAmB,CAAA;AAC1B,OAAO,oBAAoB,CAAA"}
✄
import "./cipher/cipher.js";
import './foundation/include.js';
import './jailbreak/include.js';
import './service/include.js';
import './breaker/include.js';
import './lang/include.js';
import './hooks/include.js';
✄
{"version":3,"file":"enum.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/jailbreak/enum.ts"],"names":[],"mappings":"AAAA,GAAG;AACH,KAAK;AACL,0BAA0B;AAC1B,MAAM;AACN,uEAAuE;AACvE,uEAAuE;AACvE,qEAAqE;AACrE,0EAA0E;AAC1E,gEAAgE;AAChE,mEAAmE;AACnE,oEAAoE;AACpE,2EAA2E;AAC3E,2EAA2E;AAC3E,iEAAiE;AACjE,qEAAqE;AACrE,yEAAyE;AACzE,yEAAyE;AACzE,wEAAwE;AACxE,qEAAqE;AACrE,4EAA4E;AAC5E,qEAAqE;AACrE,iFAAiF;AACjF,8EAA8E;AAC9E,6EAA6E;AAC7E,+EAA+E;AAC/E,uEAAuE;AACvE,qDAAqD;AACrD,+EAA+E;AAC/E,yEAAyE;AACzE,+EAA+E;AAC/E,qEAAqE;AACrE,sEAAsE;AACtE,8EAA8E;AAC9E,6EAA6E;AAC7E,2EAA2E;AAC3E,yEAAyE;AACzE,8EAA8E;AAC9E,uDAAuD;AACvD,mEAAmE;AACnE,iEAAiE;AACjE,sEAAsE;AACtE,+EAA+E;AAC/E,qCAAqC;AACrC,8CAA8C;AAC9C,kFAAkF;AAClF,kEAAkE;AAClE,+EAA+E;AAC/E,oDAAoD;AACpD,oDAAoD;AACpD,6EAA6E;AAC7E,oDAAoD;AACpD,8EAA8E;AAC9E,sEAAsE;AACtE,kFAAkF;AAClF,4EAA4E;AAC5E,8BAA8B;AAC9B,qCAAqC;AACrC,oCAAoC;AACpC,+EAA+E;AAC/E,gFAAgF;AAChF,iFAAiF;AACjF,oHAAoH;AACpH,wFAAwF;AACxF,sDAAsD;AACtD,8FAA8F;AAC9F,6FAA6F;AAC7F,qEAAqE;AACrE,sEAAsE;AACtE,8FAA8F;AAC9F,sEAAsE;AACtE,yFAAyF;AACzF,2FAA2F;AAC3F,4FAA4F;AAC5F,4EAA4E;AAC5E,oEAAoE;AACpE,yCAAyC;AACzC,qCAAqC;AACrC,mEAAmE;AACnE,oGAAoG;AACpG,oEAAoE;AACpE,yEAAyE;AAEzE,MAAM,CAAN,IAAY,QAYX;AAZD,WAAY,QAAQ;IAChB,2DAAkB,CAAA;IAClB,0DAAkB,CAAA;IAClB,sDAAgB,CAAA;IAChB,4DAAmB,CAAA;IACnB,oDAAe,CAAA;IACf,kDAAc,CAAA;IACd,kDAAc,CAAA;IACd,kDAAc,CAAA;IACd,sDAAgB,CAAA;IAChB,wDAAiB,CAAA;IACjB,KAAK;AACT,CAAC,EAZW,QAAQ,KAAR,QAAQ,QAYnB;AAGD,kBAAkB;AAClB,uDAAuD;AACvD,4EAA4E;AAC5E,+DAA+D;AAC/D,gFAAgF;AAChF,sEAAsE;AACtE,qEAAqE;AACrE,+DAA+D;AAC/D,kEAAkE;AAClE,2DAA2D;AAC3D,8EAA8E;AAE9E,MAAM,CAAN,IAAY,QAWX;AAXD,WAAY,QAAQ;IAChB,mDAAc,CAAA;IACd,+CAAY,CAAA;IACZ,2CAAU,CAAA;IACV,6CAAW,CAAA;IACX,6CAAW,CAAA;IACX,iDAAa,CAAA;IACb,2CAAU,CAAA;IACV,qDAAe,CAAA;IACf,+CAAY,CAAA;IACZ,iDAAa,CAAA;AACjB,CAAC,EAXW,QAAQ,KAAR,QAAQ,QAWnB"}
✄
// 
// /*
//  * CTL_KERN identifiers
//  */
// #define KERN_OSTYPE              1      /* string: system version */
// #define KERN_OSRELEASE           2      /* string: system release */
// #define KERN_OSREV               3      /* int: system revision */
// #define KERN_VERSION             4      /* string: compile time info */
// #define KERN_MAXVNODES           5      /* int: max vnodes */
// #define KERN_MAXPROC             6      /* int: max processes */
// #define KERN_MAXFILES            7      /* int: max open files */
// #define KERN_ARGMAX              8      /* int: max arguments to exec */
// #define KERN_SECURELVL           9      /* int: system security level */
// #define KERN_HOSTNAME           10      /* string: hostname */
// #define KERN_HOSTID             11      /* int: host identifier */
// #define KERN_CLOCKRATE          12      /* struct: struct clockrate */
// #define KERN_VNODE              13      /* struct: vnode structures */
// #define KERN_PROC               14      /* struct: process entries */
// #define KERN_FILE               15      /* struct: file entries */
// #define KERN_PROF               16      /* node: kernel profiling info */
// #define KERN_POSIX1             17      /* int: POSIX.1 version */
// #define KERN_NGROUPS            18      /* int: # of supplemental group ids */
// #define KERN_JOB_CONTROL        19      /* int: is job control available */
// #define KERN_SAVED_IDS          20      /* int: saved set-user/group-ID */
// #define KERN_BOOTTIME           21      /* struct: time kernel was booted */
// #define KERN_NISDOMAINNAME      22      /* string: YP domain name */
// #define KERN_DOMAINNAME         KERN_NISDOMAINNAME
// #define KERN_MAXPARTITIONS      23      /* int: number of partitions/disk */
// #define KERN_KDEBUG             24      /* int: kernel trace points */
// #define KERN_UPDATEINTERVAL     25      /* int: update process sleep time */
// #define KERN_OSRELDATE          26      /* int: OS release date */
// #define KERN_NTP_PLL            27      /* node: NTP PLL control */
// #define KERN_BOOTFILE           28      /* string: name of booted kernel */
// #define KERN_MAXFILESPERPROC    29      /* int: max open files per proc */
// #define KERN_MAXPROCPERUID      30      /* int: max processes per uid */
// #define KERN_DUMPDEV            31      /* dev_t: device to dump on */
// #define KERN_IPC                32      /* node: anything related to IPC */
// #define KERN_DUMMY              33      /* unused */
// #define KERN_PS_STRINGS 34      /* int: address of PS_STRINGS */
// #define KERN_USRSTACK32 35      /* int: address of USRSTACK */
// #define KERN_LOGSIGEXIT 36      /* int: do we log sigexit procs? */
// #define KERN_SYMFILE            37      /* string: kernel symbol filename */
// #define KERN_PROCARGS           38
// /* 39 was KERN_PCSAMPLES... now obsolete */
// #define KERN_NETBOOT            40      /* int: are we netbooted? 1=yes,0=no */
// /* 41 was KERN_PANICINFO : panic UI information (deprecated) */
// #define KERN_SYSV               42      /* node: System V IPC information */
// #define KERN_AFFINITY           43      /* xxx */
// #define KERN_TRANSLATE          44      /* xxx */
// #define KERN_CLASSIC            KERN_TRANSLATE  /* XXX backwards compat */
// #define KERN_EXEC               45      /* xxx */
// #define KERN_CLASSICHANDLER     KERN_EXEC /* XXX backwards compatibility */
// #define KERN_AIOMAX             46      /* int: max aio requests */
// #define KERN_AIOPROCMAX         47      /* int: max aio requests per process */
// #define KERN_AIOTHREADS         48      /* int: max aio worker threads */
// #ifdef __APPLE_API_UNSTABLE
// #define KERN_PROCARGS2          49
// #endif /* __APPLE_API_UNSTABLE */
// #define KERN_COREFILE           50      /* string: corefile format string */
// #define KERN_COREDUMP           51      /* int: whether to coredump at all */
// #define KERN_SUGID_COREDUMP     52      /* int: whether to dump SUGID cores */
// #define KERN_PROCDELAYTERM      53      /* int: set/reset current proc for delayed termination during shutdown */
// #define KERN_SHREG_PRIVATIZABLE 54      /* int: can shared regions be privatized ? */
// /* 55 was KERN_PROC_LOW_PRI_IO... now deprecated */
// #define KERN_LOW_PRI_WINDOW     56      /* int: set/reset throttle window - milliseconds */
// #define KERN_LOW_PRI_DELAY      57      /* int: set/reset throttle delay - milliseconds */
// #define KERN_POSIX              58      /* node: posix tunables */
// #define KERN_USRSTACK64         59      /* LP64 user stack query */
// #define KERN_NX_PROTECTION      60      /* int: whether no-execute protection is enabled */
// #define KERN_TFP                61      /* Task for pid settings */
// #define KERN_PROCNAME           62      /* setup process program  name(2*MAXCOMLEN) */
// #define KERN_THALTSTACK         63      /* for compat with older x86 and does nothing */
// #define KERN_SPECULATIVE_READS  64      /* int: whether speculative reads are disabled */
// #define KERN_OSVERSION          65      /* for build number i.e. 9A127 */
// #define KERN_SAFEBOOT           66      /* are we booted safe? */
// /*	67 was KERN_LCTX (login context) */
// #define KERN_RAGEVNODE          68
// #define KERN_TTY                69      /* node: tty settings */
// #define KERN_CHECKOPENEVT       70      /* spi: check the VOPENEVT flag on vnodes at open time */
// #define KERN_THREADNAME         71      /* set/get thread name */
// #define KERN_MAXID              72      /* number of valid kern ids */
export var CTL_KERN;
(function (CTL_KERN) {
    CTL_KERN[CTL_KERN["KERN_SECURELVL"] = 9] = "KERN_SECURELVL";
    CTL_KERN[CTL_KERN["KERN_HOSTNAME"] = 10] = "KERN_HOSTNAME";
    CTL_KERN[CTL_KERN["KERN_HOSTID"] = 11] = "KERN_HOSTID";
    CTL_KERN[CTL_KERN["KERN_CLOCKRATE"] = 12] = "KERN_CLOCKRATE";
    CTL_KERN[CTL_KERN["KERN_VNODE"] = 13] = "KERN_VNODE";
    CTL_KERN[CTL_KERN["KERN_PROC"] = 14] = "KERN_PROC";
    CTL_KERN[CTL_KERN["KERN_FILE"] = 15] = "KERN_FILE";
    CTL_KERN[CTL_KERN["KERN_PROF"] = 16] = "KERN_PROF";
    CTL_KERN[CTL_KERN["KERN_POSIX1"] = 17] = "KERN_POSIX1";
    CTL_KERN[CTL_KERN["KERN_NGROUPS"] = 18] = "KERN_NGROUPS";
    //...
})(CTL_KERN || (CTL_KERN = {}));
// 第一个name数组可以包含以下
// #define CTL_UNSPEC      0               /* unused */
// #define CTL_KERN        1               /* "high kernel": proc, limits */
// #define CTL_VM          2               /* virtual memory */
// #define CTL_VFS         3               /* file system, mount type is next */
// #define CTL_NET         4               /* network, see socket.h */
// #define CTL_DEBUG       5               /* debugging parameters */
// #define CTL_HW          6               /* generic cpu/io */
// #define CTL_MACHDEP     7               /* machine dependent */
// #define CTL_USER        8               /* user-level */
// #define CTL_MAXID       9               /* number of valid top-level ids */
export var CTLT_YPE;
(function (CTLT_YPE) {
    CTLT_YPE[CTLT_YPE["CTL_UNSPEC"] = 0] = "CTL_UNSPEC";
    CTLT_YPE[CTLT_YPE["CTL_KERN"] = 1] = "CTL_KERN";
    CTLT_YPE[CTLT_YPE["CTL_VM"] = 2] = "CTL_VM";
    CTLT_YPE[CTLT_YPE["CTL_VFS"] = 3] = "CTL_VFS";
    CTLT_YPE[CTLT_YPE["CTL_NET"] = 4] = "CTL_NET";
    CTLT_YPE[CTLT_YPE["CTL_DEBUG"] = 5] = "CTL_DEBUG";
    CTLT_YPE[CTLT_YPE["CTL_HW"] = 6] = "CTL_HW";
    CTLT_YPE[CTLT_YPE["CTL_MACHDEP"] = 7] = "CTL_MACHDEP";
    CTLT_YPE[CTLT_YPE["CTL_USER"] = 8] = "CTL_USER";
    CTLT_YPE[CTLT_YPE["CTL_MAXID"] = 9] = "CTL_MAXID";
})(CTLT_YPE || (CTLT_YPE = {}));
✄
{"version":3,"file":"hooks.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/jailbreak/hooks.ts"],"names":[],"mappings":"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"}
✄
// import { CTLT_YPE } from "./enum"
const SLOG = true; // simple log
const checkIfContainJbPaths = (str) => {
    // The string that may be detected
    const JbPaths = [
        "/Applications/Cydia.app",
        "/usr/sbin/sshd",
        "/bin/bash",
        "/etc/apt",
        "/Library/MobileSubstrate",
        "/User/Applications/",
        "/private/var/lib/apt/",
        "/private/var/lib/cydia/",
        "substitute",
        "substrate",
        "CepheiUI"
    ];
    return JbPaths.some(item => str.includes(item));
};
export const hook_stat = () => {
    logd("hook stat & lstat");
    // int stat(const char *, struct stat *)
    // 成功返回 0  失败返回 -1
    // #define __DARWIN_STRUCT_STAT64 { \
    // 	dev_t		st_dev;                 /* [XSI] ID of device containing file */ \ 设备编号
    // 	mode_t		st_mode;                /* [XSI] Mode of file (see below) */ \  文件类型及权限
    // 	nlink_t		st_nlink;               /* [XSI] Number of hard links */ \ 硬链接数量
    // 	__darwin_ino64_t st_ino;                /* [XSI] File serial number */ \ inode 编号
    // 	uid_t		st_uid;                 /* [XSI] User ID of the file */ \ 拥有者的用户 ID
    // 	gid_t		st_gid;                 /* [XSI] Group ID of the file */ \ 拥有者的组 ID
    // 	dev_t		st_rdev;                /* [XSI] Device ID */ \
    // 	__DARWIN_STRUCT_STAT64_TIMES \
    // 	off_t		st_size;                /* [XSI] file size, in bytes */ \ 文件大小（以字节为单位）
    // 	blkcnt_t	st_blocks;              /* [XSI] blocks allocated for file */ \
    // 	blksize_t	st_blksize;             /* [XSI] optimal blocksize for I/O */ \
    // 	__uint32_t	st_flags;               /* user defined flags for file */ \
    // 	__uint32_t	st_gen;                 /* file generation number */ \
    // 	__int32_t	st_lspare;              /* RESERVED: DO NOT USE! */ \
    // 	__int64_t	st_qspare[2];           /* RESERVED: DO NOT USE! */ \
    // }
    const addr = Module.findExportByName("libsystem_kernel.dylib", "stat");
    Interceptor.attach(addr, {
        onEnter(args) {
            this.disp = `stat ( '${args[0].readCString()}', ${args[1]} )`;
        },
        onLeave(retval) {
            if (checkIfContainJbPaths(this.disp)) {
                loge(`${retval} <= ${this.disp}`);
                retval.replace(ptr(-1));
            }
            else {
                if (!SLOG)
                    logd(`${retval} <= ${this.disp}`);
            }
        }
    });
    // int     lstat(const char *, struct stat *) __DARWIN_INODE64(lstat);
    const addr2 = Module.findExportByName("libsystem_kernel.dylib", "lstat");
    Interceptor.attach(addr2, {
        onEnter(args) {
            this.disp = `lstat ( '${args[0].readCString()}', ${args[1]} )`;
        },
        onLeave(retval) {
            if (checkIfContainJbPaths(this.disp)) {
                loge(`${retval} <= ${this.disp}`);
                retval.replace(ptr(-1));
            }
            else {
                if (!SLOG)
                    logd(`${retval} <= ${this.disp}`);
            }
        }
    });
};
const hook_NSString_IsEqualToString = () => {
    logd("hook NSString_IsEqualToString");
    const addr = ptr(ObjC.classes["NSString"]["- isEqualToString:"].implementation);
    Interceptor.attach(addr, {
        onEnter(args) {
            logw("NSString - isEqualToString");
            let thiz = new ObjC.Object(args[0]);
            let SEL = ObjC.selectorAsString(args[1]);
            let str = new ObjC.Object(args[1]).toString();
            this.disp = `${thiz} ${SEL} ${str}`;
        },
        onLeave(retval) {
            if (checkIfContainJbPaths(this.disp)) {
                loge(`${retval} <= ${this.disp}`);
            }
            else {
                if (!SLOG)
                    logd(`${retval} <= ${this.disp}`);
            }
        }
    });
};
// dladdr
const hook_dladdr = () => {
    const addr = Module.findExportByName("libsystem_kernel.dylib", "dladdr");
    Interceptor.attach(addr, {
        onEnter(args) {
            // typedef struct dl_info {
            //         const char      *dli_fname;     /* Pathname of shared object */
            //         void            *dli_fbase;     /* Base address of shared object */
            //         const char      *dli_sname;     /* Name of nearest symbol */
            //         void            *dli_saddr;     /* Address of nearest symbol */
            // } Dl_info;
            this.disp = `dladdr ( ${args[0]}, ${args[1]} )`;
        },
        onLeave(retval) {
            if (checkIfContainJbPaths(this.disp)) { }
        }
    });
};
// hook isDebugged
// 校验当前进程是否为调试模式，hook sysctl方法可以绕过
// Returns true if the current process is being debugged (either
// running under the debugger or has a debugger attached post facto).
// Thanks to https://developer.apple.com/library/archive/qa/qa1361/_index.html
// sysctl 是一个用于查询和设置内核参数的系统调用。它主要用于获取或更改系统信息，例如 CPU 类型、内存大小，以及其他系统级别的配置
// int sysctl(int *name, u_int namelen, void *oldp, size_t *oldlenp, const void *newp, size_t newlen);
// 成功返回 0 失败返回 -1
/**
 * IMPL ↓
 * BOOL isDebugged()
{
    int junk;
    int mib[4];
    struct kinfo_proc info;
    size_t size;
    info.kp_proc.p_flag = 0; // 指向存储查询结果的缓冲区的指针,如果只是想设置系统参数,设置为NULL
    mib[0] = CTL_KERN;  // 整数数组，用于指定要查询或设置的系统参数 0x4
    mib[1] = KERN_PROC;
    mib[2] = KERN_PROC_PID;
    mib[3] = getpid();
    size = sizeof(info);
    junk = sysctl(mib, sizeof(mib) / sizeof(*mib), &info, &size, NULL, 0);
    assert(junk == 0);
    return ( (info.kp_proc.p_flag & P_TRACED) != 0 );
}
 */
// Process.enumerateModules()
//     .forEach(module => {
//         module.enumerateSymbols()
//         .forEach(symbol => {
//             if (symbol.name.includes("sysctl") && !symbol.address.isNull()) {
//                 logd(`${symbol.address} <= ${symbol.name}`)
//             }
//         })
//     })
const hook_isDebugged = () => {
    logd("hook sysctl | isDebugged");
    let addr_sysctl = Module.findExportByName("libsystem_c.dylib", "sysctl");
    // addr_sysctl = DebugSymbol.fromName("sysctl").address <- 这里被坑了 重名符号 返回的是最后一个
    // DebugSymbol.fromName("sysctl")
    // {
    //     "address": "0x101214e30",
    //     "column": 0,
    //     "fileName": "",
    //     "lineNumber": 0,
    //     "moduleName": "dyld",
    //     "name": "sysctl"
    // }
    Interceptor.attach(addr_sysctl, {
        onEnter(args) {
            // junk = sysctl(mib, sizeof(mib) / sizeof(*mib), &info, &size, NULL, 0);
            // int sysctl(int *name, u_int namelen, void *oldp, size_t *oldlenp, const void *newp, size_t newlen);
            this.disp = `  ( name=${args[0]}, namelen=${args[1]}, oldp=${args[2]}, oldlenp=${args[3]}, newp=${args[4]}, newlen${args[5]} )`;
            let tmp = '';
            for (let i = 0; i < args[1].toInt32(); i++) { // int* ++
                // if (i == 0) {
                //     tmp += `${CTLT_YPE[args[0].readInt()].toString()} | `
                // } else {
                tmp += `${[args[0].add(i).readInt()].toString()} | `;
                // }
            }
            this.disp1 = tmp.substring(0, tmp.length - 3);
            this.info = args[2];
        },
        onLeave(retval) {
            logd(`${retval} <= ${this.disp}`);
            logz(`\t${this.disp1}`);
            // struct kinfo_proc {
            // struct  extern_proc kp_proc;                    /* proc structure */
            // struct  eproc {
            // 	struct  proc *e_paddr;          /* address of proc */
            // 	struct  session *e_sess;        /* session pointer */
            // 	struct  _pcred e_pcred;         /* process credentials */
            // 由上可见就是第一个结构体
            // struct extern_proc {
            // 	union {
            // 		struct {
            // 			struct  proc *__p_forw; /* Doubly-linked run/sleep queue. */
            // 			struct  proc *__p_back;
            // 		} p_st1;
            // 		struct timeval __p_starttime;   /* process start time */
            // 	} p_un;
            // #define p_forw p_un.p_st1.__p_forw
            // #define p_back p_un.p_st1.__p_back
            // #define p_starttime p_un.__p_starttime
            // 	struct  vmspace *p_vmspace;     /* Address space. */
            // 	struct  sigacts *p_sigacts;     /* Signal actions, state (PROC ONLY). */
            // 	int     p_flag;                 /* P_* flags. */
            // (lldb) p/a &(info.kp_proc)
            // (extern_proc *) 0x000000016ef08ef0
            // (lldb) p/a &(info.kp_proc.p_flag)
            // (int *) 0x000000016ef08f10
            // ofset 0x20 = pointersize * 4
            // p/x info.kp_proc.p_flag => (int) 0x04004804
            // p/x  ~0x800 & 0x04004804 
            // #define P_TRACED        0x00000800      /* Debugged process being traced */
            let p_flag_addr = ptr(this.info).add(Process.pointerSize * 4);
            logz(`\t${p_flag_addr} => ${p_flag_addr.readPointer()}`);
            if (p_flag_addr.readInt() & 0x00000800) {
                loge(`\t! bypass isDebug`);
                p_flag_addr.writePointer(p_flag_addr.readPointer().and(~0x00000800));
            }
        }
    });
};
// _dyld_get_image_name
const hook_get_image_name = () => {
    logd("hook dyld_get_image_name");
    // extern const char* _dyld_get_image_name(uint32_t image_index) 
    // __OSX_AVAILABLE_STARTING(__MAC_10_1, __IPHONE_2_0);
    const addr = Module.findExportByName("libdyld.dylib", "_dyld_get_image_name");
    Interceptor.attach(addr, {
        onEnter(args) {
            this.disp = `dyld_get_image_name ( index=${args[0]} | ${args[0].toInt32()} )`;
        },
        onLeave(retval) {
            const ret_str = retval.readCString();
            if (ret_str == null)
                return;
            const disp_str = `${this.disp} => '${ret_str}'`;
            if (!SLOG)
                logd(disp_str);
            if (ret_str.includes("substitute")
                || ret_str.includes("substrate")
                || ret_str.includes("CepheiUI")) {
                loge(disp_str);
                const new_ret = ret_str
                    .replace("substitute", "---")
                    .replace("substrate", "---")
                    .replace("CepheiUI", "---");
                retval.replace(Memory.allocUtf8String(new_ret));
                logd('called from:\n' +
                    Thread.backtrace(this.context, Backtracer.ACCURATE)
                        .map(DebugSymbol.fromAddress).join('\n') + '\n');
                return;
            }
        }
    });
};
const hook_canOpenURL = () => {
    logd("hook canOpenURL");
    const old_Method_canOpenURL = ObjC.classes["UIApplication"]["- canOpenURL:"];
    const old_impl = old_Method_canOpenURL.implementation;
    old_Method_canOpenURL.implementation = ObjC.implement(old_Method_canOpenURL, function (clazz, selector, URLString) {
        // [[UIApplication sharedApplication] canOpenURL:[NSURL URLWithString:@"cydia://package/com.avl.com"]]
        const disp = `canOpenURL ( ${new ObjC.Object(clazz)}, ${ObjC.selectorAsString(selector)}, ${new ObjC.Object(URLString)} )`;
        let retval = old_impl(clazz, selector, URLString);
        if (disp.includes("cydia") || disp.includes("Cydia")) {
            loge(`${retval} <= ${disp}`);
            retval = 0;
        }
        else {
            if (!SLOG)
                logd(`${retval} <= ${disp}`);
        }
        return retval;
    });
};
const hook_URLWithString = () => {
    logd("hook URLWithString");
    const old_func = ObjC.classes.NSURL.URLWithString_;
    const old_impl = old_func.implementation;
    old_func.implementation = ObjC.implement(old_func, function (clazz, selector, URLString) {
        let toCString = new ObjC.Object(URLString).toString();
        const disp = `URLWithString ( '${toCString}' )`;
        if (disp.includes("cydia")) {
            URLString = ObjC.classes.NSString.stringWithString_(toCString.replace("cydia", "ccc"));
            loge(`${disp}`);
        }
        else {
            if (!SLOG)
                logd(`${disp}`);
        }
        return old_impl(clazz, selector, URLString);
    });
};
const hook_NSFileManager = () => {
    logd("hook NSFileManager");
    const isOpenJailFile = [
        "/Application/Cydia.app",
        "/Library/MobileSubstrate/MobileSubstrate.dylib",
        "/bin/bash",
        "/etc/apt",
        "/private/var/lib/apt",
        "/private/var/lib/cydia",
        "/private/var/tmp/cydia.log",
        "/Applications/WinterBoard.app",
        "/var/lib/cydia",
        "/private/etc/dpkg/origins/debian",
        "/bin.sh",
        "/private/etc/apt",
        "/etc/ssh/sshd_config",
        "/private/etc/ssh/sshd_config",
        "/Applications/SBSetttings.app",
        "/private/var/mobileLibrary/SBSettingsThemes/",
        "/private/var/stash",
        "/usr/libexec/sftp-server",
        "/usr/libexec/cydia/",
        "/usr/sbin/frida-server",
        "/usr/bin/cycript",
        "/usr/local/bin/cycript",
        "/usr/lib/libcycript.dylib",
        "/System/Library/LaunchDaemons/com.saurik.Cydia.Startup.plist",
        "/System/Library/LaunchDaemons/com.saurik.Cy@dia.Startup.plist",
        "/System/Library/LaunchDaemons/com.ikey.bbot.plist",
        "/Applications/FakeCarrier.app",
        "/Library/MobileSubstrate/DynamicLibraries/Veency.plist",
        "/Library/MobileSubstrate/DynamicLibraries/LiveClock.plist",
        "/usr/libexec/ssh-keysign",
        "/usr/libexec/sftp-server",
        "/Applications/blackra1n.app",
        "/Applications/IntelliScreen.app",
        "/Applications/Snoop-itConfig.app",
        "/var/lib/dpkg/info",
        "/Applications/Icy.app",
        "/Applications/MxTube.app",
        "/Applications/RockApp.app",
        "/bin/sh",
        "/usr/bin/ssh",
        "/usr/bin/sshd",
        "/usr/sbin/sshd",
        "/var/cache/apt",
        "/var/log/syslog",
        "/var/tmp/cydia.log",
    ];
    // - fileExistsAtPath:isDirectory:
    // - (BOOL)fileExistsAtPath:(NSString *)path isDirectory:(nullable BOOL *)isDirectory;
    const old_func = ObjC.classes.NSFileManager["- fileExistsAtPath:isDirectory:"];
    const old_impl = old_func.implementation;
    old_func.implementation = ObjC.implement(old_func, function (clazz, selector, fileExistsAtPath, isDirectory) {
        if (!fileExistsAtPath)
            return old_impl(clazz, selector, fileExistsAtPath, isDirectory);
        const toCString = new ObjC.Object(fileExistsAtPath).toString();
        const disp = `fileExistsAtPath:isDirectory: ( '${toCString}', ${isDirectory} )`;
        if (isOpenJailFile.includes(toCString)) {
            loge(`${disp}`);
            // fileExistsAtPath = ObjC.classes.NSString.stringWithString_("zzzz")
            return 0;
        }
        else if (!SLOG) {
            logd(`${disp}`);
        }
        return old_impl(clazz, selector, fileExistsAtPath, isDirectory);
    });
    // fopen
    // FILE	*fopen(const char * __restrict __filename, const char * __restrict __mode)
    Interceptor.attach(Module.findExportByName("libsystem_c.dylib", "fopen"), {
        onEnter(args) {
            const fileName = args[0].readCString();
            if (fileName != null) {
                const disp = `fopen ( ${fileName} )`;
                if (isOpenJailFile.includes(fileName)) {
                    loge(`${disp}`);
                    args[0] = Memory.allocUtf8String("zzzz");
                }
                else if (!SLOG) {
                    logd(`${disp}`);
                }
            }
        }
    });
};
const hook_getenv = () => {
    logd("hook getenv");
    // getenv
    // char	*getenv(const char *);
    Interceptor.attach(Module.findExportByName("libsystem_c.dylib", "getenv"), {
        onEnter(args) {
            this.envName = args[0].readCString();
        },
        onLeave(retval) {
            const disp = `getenv ( ${this.envName} ) | ret: '${retval.readCString()}'`;
            if (this.envName != null && this.envName == "DYLD_INSERT_LIBRARIES") {
                loge(`${disp}`);
                retval.replace(NULL);
                logd('called from:\n' +
                    Thread.backtrace(this.context, Backtracer.ACCURATE)
                        .map(DebugSymbol.fromAddress).join('\n') + '\n');
            }
            else if (!SLOG) {
                logd(`${disp}`);
            }
        }
    });
};
const hook_ptrace = () => {
    logd("hook ptrace");
    // void mRiYXNnZnZmZGF2Ym() {
    //     // No Need to encode these strings, because they will be directly compiled, they are not going to be present in the 'DATA' segment of the binary.
    //     __asm (
    //         "mov r0, #31\n" // set #define PT_DENY_ATTACH (31) to r0
    //         "mov r1, #0\n"   // clear r1
    //         "mov r2, #0\n"   // clear r2
    //         "mov r3, #0\n"   // clear r3
    //         "mov ip, #26\n"  // set the instruction pointer to syscal 26
    //         "svc #0x80\n"    // SVC (formerly SWI) generates a supervisor call. Supervisor calls are normally used to request privileged operations or access to system resources from an operating system
    //         );
    // }
    // ptrace(PT_DENY_ATTACH, 0, 0, 0);
    // ↑ 还有可能是使用系统调用实现 这里不做处理 trace指令查看svc调用 不在这里实现 ↑
    // int ptrace(int request, pid_t pid, caddr_t addr, int data);
    // #define PT_DENY_ATTACH 31
    const PT_DENY_ATTACH = 31;
    const addr = Module.findExportByName("libsystem_kernel.dylib", "ptrace");
    const srcCall = new NativeFunction(addr, "int", ["int", "int", "pointer", "int"]);
    Interceptor.revert(addr);
    Interceptor.replace(addr, new NativeCallback((request, pid, addr, data) => {
        loge(`called ptrace( ${request}, ${pid}, ${addr}, ${data} )`);
        if (request == PT_DENY_ATTACH)
            return 0;
        return srcCall(request, pid, addr, data);
    }, "int", ["int", "int", "pointer", "int"]));
};
const hook_NSClassFromString = () => {
    logd("hook NSClassFromString");
    // 从类名获取类 类似java的Class.forName
    const checkArray = [
        "HBPreferences", // 用于以越狱环境下从偏好设置读取配置项
    ];
    // FOUNDATION_EXPORT Class _Nullable NSClassFromString(NSString *aClassName);
    Interceptor.attach(Module.findExportByName("Foundation", "NSClassFromString"), {
        onEnter(args) {
            // Foundation -> -[NSString(NSStringOtherEncodings) UTF8String]
            try {
                // this.className = new ObjC.Object(args[0]).UTF8String()
                this.className = new ObjC.Object(args[0]).toString();
            }
            catch (error) {
                this.className = '';
            }
        },
        onLeave(retval) {
            if (checkArray.includes(this.className)) {
                loge(`${retval} <= NSClassFromString( '${this.className}' )`);
                retval.replace(NULL);
            }
            else {
                if (!SLOG)
                    logw(`${retval} <= ${this.className}`);
            }
        }
    });
};
globalThis.hook_all_detect = () => {
    hook_stat();
    // hook_NSString_IsEqualToString()
    // hook_isDebugged()
    hook_get_image_name();
    hook_canOpenURL();
    hook_URLWithString();
    hook_NSFileManager();
    hook_getenv();
    hook_ptrace();
    hook_NSClassFromString();
};
globalThis.hook_stat = hook_stat;
globalThis.hook_NSString_IsEqualToString = hook_NSString_IsEqualToString;
globalThis.hook_isDebugged = hook_isDebugged;
globalThis.hook_get_image_name = hook_get_image_name;
globalThis.hook_canOpenURL = hook_canOpenURL;
globalThis.hook_URLWithString = hook_URLWithString;
globalThis.hook_NSFileManager = hook_NSFileManager;
globalThis.hook_getenv = hook_getenv;
globalThis.hook_ptrace = hook_ptrace;
globalThis.hook_NSClassFromString = hook_NSClassFromString;
globalThis.hook_exit = () => {
    Interceptor.attach(Module.findExportByName(null, "exit"), {
        onEnter(args) {
            const backtrace = Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join("\n\t");
            console.warn("\n[-] ======== Backtrace Start  ========");
            console.log(backtrace);
            console.warn("\n[-] ======== Backtrace End  ========");
        },
    });
};
globalThis.hook_strcmp = () => {
    Interceptor.attach(Module.findExportByName(null, "strcmp"), {
        onEnter(args) {
            const arg0 = args[0].readCString();
            const arg1 = args[1].readCString();
            logd(`strcmp ( ${arg0}, ${arg1} )`);
        },
    });
};
// if (ObjC.available) {
//     const NSString = ObjC.classes.NSString
//     Interceptor.attach(NSString["- isEqualToString:"].implementation, {
//         onEnter: function (args) {
//             // args[0] 是 'self'
//             // args[1] 是 '_cmd'（这里的命令或方法选择器）
//             // args[2] 是与之比较的 NSString 对象
//             const selfStr = new ObjC.Object(args[0]).toString()
//             const compareStr = new ObjC.Object(args[2]).toString()
//             this.passStr = `'${selfStr}', '${compareStr}'`
//         },
//         onLeave: function (retval) {
//             logd(`isEqualToString: ( ${this.passStr}) | Returns ${retval}`)
//         }
//     })
// } else {
//     loge("Objective-C runtime is not available.")
// }
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/jailbreak/include.ts"],"names":[],"mappings":"AAAA,OAAO,WAAW,CAAA;AAClB,OAAO,WAAW,CAAA;AAElB,OAAO,aAAa,CAAA;AACpB,OAAO,YAAY,CAAA"}
✄
import './jail.js';
import './enum.js';
import './thread.js';
import './hooks.js';
✄
{"version":3,"file":"jail.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/jailbreak/jail.ts"],"names":[],"mappings":""}
✄
export {};
✄
{"version":3,"file":"thread.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/jailbreak/thread.ts"],"names":[],"mappings":"AAEA,MAAM,WAAW,GAAG,GAAE,EAAE;IAEpB,yCAAyC;IACzC,WAAW,CAAC,MAAM,CAAC,MAAM,CAAC,eAAe,CAAC,yBAAyB,EAAE,gBAAgB,CAAC,EAAC;QACnF,OAAO,EAAE,UAAS,IAAI;YAClB,MAAM,SAAS,GAAG,gBAAgB;gBAC9B,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,UAAU,CAAC,QAAQ,CAAC;qBAC9C,GAAG,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAA;YACvD,OAAO,CAAC,GAAG,CAAC,SAAS,CAAC,CAAA;YACtB,IAAI,SAAS,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE;gBAChC,IAAI,CAAC,2BAA2B,CAAC,CAAA;aACpC;iBAAM;gBACH,IAAI,CAAC,2BAA2B,CAAC,CAAA;aACpC;YACD,OAAO,CAAC,GAAG,CAAC,2BAA2B,CAAC,CAAA;YACxC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAA;YAClC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAA;YAClC,OAAO,CAAC,GAAG,CAAC,aAAa,EAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAA;QACtC,CAAC;KACJ,CAAC,CAAA;AAEN,CAAC,CAAA;AAMD,UAAU,CAAC,WAAW,GAAG,WAAW,CAAA"}
✄
const hook_thread = () => {
    // libsystem_pthread.dylib!_pthread_start
    Interceptor.attach(Module.getExportByName("libsystem_pthread.dylib", "_pthread_start"), {
        onEnter: function (args) {
            const backTrace = 'called from:\n' +
                Thread.backtrace(this.context, Backtracer.ACCURATE)
                    .map(DebugSymbol.fromAddress).join('\n') + '\n';
            console.log(backTrace);
            if (backTrace.includes("tersafe2")) {
                loge("[!] _pthread_start called");
            }
            else {
                logd("[!] _pthread_start called");
            }
            console.log("[*] _pthread_start called");
            console.log("[*] args[0]", args[0]);
            console.log("[*] args[1]", args[1]);
            console.log("[*] args[2]", args[2]);
        }
    });
};
globalThis.hook_thread = hook_thread;
export {};
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/include.ts"],"names":[],"mappings":"AAAA,OAAO,iBAAiB,CAAA;AACxB,OAAO,oBAAoB,CAAA"}
✄
import './oc/include.js';
import './swift/include.js';
✄
{"version":3,"file":"ViewController.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/oc/ViewController.ts"],"names":[],"mappings":"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"}
✄
const hook_ViewController = () => {
    {
        // enter ↓
        // - presentViewController:animated:completion:
        Interceptor.attach(ObjC.classes["UIViewController"]["- presentViewController:animated:completion:"].implementation, {
            onEnter(args) {
                const instance = new ObjC.Object(args[0]);
                logd(`\nCalled presentViewController:'${instance}' -> '${new ObjC.Object(args[2])}' animated:'${args[3]}' completion:${args[4]}`);
                const _storyboard = instance.$ivars["_storyboard"];
                const _modalPresentationStyle = instance.$ivars["_modalPresentationStyle"];
                logz(`\t_storyboard:${_storyboard} | _modalPresentationStyle:${_modalPresentationStyle}`);
            }
        });
        // - presentViewController:withTransition:completion:
        Interceptor.attach(ObjC.classes["UIViewController"]["- presentViewController:animated:completion:"].implementation, {
            onEnter(args) {
                const instance = new ObjC.Object(args[0]);
                logd(`\nCalled presentViewController:'${instance}' -> '${new ObjC.Object(args[2])}' withTransition:'${args[3]}' completion:${args[4]}`);
                const _storyboard = instance.$ivars["_storyboard"];
                const _modalPresentationStyle = instance.$ivars["_modalPresentationStyle"];
                logz(`\t_storyboard:${_storyboard} | _modalPresentationStyle:${_modalPresentationStyle}`);
            }
        });
    }
    {
        // exit ↓
        // - dismissModalViewControllerAnimated:
        Interceptor.attach(ObjC.classes["UIViewController"]["- dismissModalViewControllerAnimated:"].implementation, {
            onEnter(args) {
                const instance = new ObjC.Object(args[0]);
                logd(`\nCalled dismissModalViewControllerAnimated:'${instance}' animated:'${args[2]}'`);
            }
        });
        // - dismissModalViewControllerWithTransition:
        Interceptor.attach(ObjC.classes["UIViewController"]["- dismissModalViewControllerWithTransition:"].implementation, {
            onEnter(args) {
                const instance = new ObjC.Object(args[0]);
                logd(`\nCalled dismissModalViewControllerWithTransition:'${instance}' Transition:'${args[2]}'`);
            }
        });
        // // - dismissViewControllerAnimated:completion:
        Interceptor.attach(ObjC.classes["UIViewController"]["- dismissViewControllerAnimated:completion:"].implementation, {
            onEnter(args) {
                const instance = new ObjC.Object(args[0]);
                logd(`\nCalled dismissViewControllerAnimated:'${instance}' Animated:'${args[2]}' completion:'${args[3]}'`);
            }
        });
        // const src_function = new NativeFunction(ObjC.classes["UIViewController"]["- dismissViewControllerAnimated:completion:"].implementation, "void", ["pointer"])
        // Interceptor.replace(ObjC.classes["UIViewController"]["- dismissViewControllerAnimated:completion:"].implementation, new NativeCallback((_instance: NativePointer, a1: NativePointer, a2: NativePointer) => {
        //     const instance = new ObjC.Object(_instance)
        //     logd(`\nCalled dismissViewControllerAnimated:'${instance}' Animated:'${a1}' completion:'${a2}'`)
        //     return
        //     // return src_function(instance)
        // }, "void", ["pointer", "pointer", "pointer"]))
        // - dismissViewControllerWithTransition:completion:
        Interceptor.attach(ObjC.classes["UIViewController"]["- dismissViewControllerWithTransition:completion:"].implementation, {
            onEnter(args) {
                const instance = new ObjC.Object(args[0]);
                logd(`\nCalled dismissViewControllerWithTransition:'${instance}' Transition:'${args[2]}' completion:'${args[3]}'`);
            }
        });
    }
};
const hook_UIAlertController = () => {
    // UIAlertController + alertControllerWithTitle:message:preferredStyle:
    Interceptor.attach(ObjC.classes["UIAlertController"]["+ alertControllerWithTitle:message:preferredStyle:"].implementation, {
        onEnter(args) {
            const title = new ObjC.Object(args[2]);
            const msg = new ObjC.Object(args[3]);
            logd(`\nCalled alertControllerWithTitle:'${title}' message:'${msg}' preferredStyle:${args[4]}`);
        }, onLeave(retval) {
            const instance = new ObjC.Object(retval);
            const _actions = instance.$ivars["_actions"];
            const count = _actions["- count"]();
            logz(`\t${instance} | actions:${_actions.handle} [ ${count} ]`);
        }
    });
    // UIAlertController - addAction:
    Interceptor.attach(ObjC.classes["UIAlertController"]["- addAction:"].implementation, {
        onEnter(args) {
            const instance = new ObjC.Object(args[0]);
            const action = new ObjC.Object(args[2]);
            logd(`\nCalled UIAlertController '${instance}' - addAction:'${action}'`);
            this.ins = instance;
        }, onLeave(retval) {
            const instance = this.ins;
            const _actions = instance.$ivars["_actions"];
            const count = _actions["- count"]();
            logz(`\t${instance} | actions:${_actions} [ ${count} ]`);
        }
    });
    // UIAlertAction + actionWithTitle:style:handler:
    Interceptor.attach(ObjC.classes["UIAlertAction"]["+ actionWithTitle:style:handler:"].implementation, {
        onEnter(args) {
            const title = new ObjC.Object(args[2]);
            // !todo parse Block
            logd(`\nCalled UIAlertAction actionWithTitle:'${title}' style:'${args[3]}' handler:'${new ObjC.Block(args[4])}'`);
        }
    });
    // var newReplyBlock = new ObjC.Block({
    //     retType: 'void',
    //     argTypes: ['int', 'pointer'],
    //     implementation: function (successOrFailure, nsError) {
    //         console.log("Success: "+successOrFailure)
    //     }
    // });
};
globalThis.hook_ViewController = hook_ViewController;
globalThis.hook_UIAlertController = hook_UIAlertController;
export {};
// setImmediate(() => {
//     Interceptor.attach(ObjC.classes["UIViewController"]["- viewDidLoad"].implementation, {
//         onEnter(args) {
//             const obj = new ObjC.Object(args[0])
//             console.warn(`\nCalled UIViewController viewDidLoad:'${obj}'`)
//         }
//     })
//     Interceptor.attach(ObjC.classes["Runner.NRViewController"]["- viewDidLoad"].implementation, {
//         onEnter(args) {
//             const obj = new ObjC.Object(args[0])
//             console.warn(`\nCalled NRViewController viewDidLoad:'${obj}'`)
//         }
//     })
//     // - application:didFinishLaunchingWithOptions:
//     // Interceptor.attach(ObjC.classes["Runner.AppDelegate"]["- application:didFinishLaunchingWithOptions:"].implementation, {
//     //     onEnter(args) {
//     //         const obj = new ObjC.Object(args[0])
//     //         console.warn(`\nCalled AppDelegate didFinishLaunchingWithOptions:'${obj}'`)
//     //         this.ins = args[0]
//     //     },
//     //     onLeave(retval) {
//     //         console.log(`${new ObjC.Object(this.ins).$ivars["_window"].$ivars["_rootViewController"]}`)
//     //         new ObjC.Object(this.ins).$ivars["_window"].$ivars["_rootViewController"] = ObjC.classes["Runner.NRViewController"]["new"]()
//     //         const backtrace = Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join("\n\t")
//     //         console.log(backtrace)
//     //         console.log(`${new ObjC.Object(this.ins).$ivars["_window"].$ivars["_rootViewController"]}`)
//     //     },
//     // })
//     const addr = ptr(ObjC.classes["Runner.AppDelegate"]["- application:didFinishLaunchingWithOptions:"].implementation)
//     console.error(addr)
//     const src_function = new NativeFunction(addr, "pointer", ["pointer", "pointer", "pointer"])
//     Interceptor.replace(addr, new NativeCallback((_instance: NativePointer, sel: NativePointer, launchOptions: NativePointer) => {
//         let ret = src_function(_instance, sel, launchOptions)
//         const instance = new ObjC.Object(_instance)
//         logd(`\nCalled didFinishLaunchingWithOptions:'${instance}' launchOptions:'${launchOptions}'`)
//         console.log(`${instance.$ivars["_window"].$ivars["_rootViewController"]}`)
//         instance.$ivars["_window"].$ivars["_rootViewController"] = ObjC.classes["Runner.NRViewController"]["new"]()
//         console.log(`${instance.$ivars["_window"].$ivars["_rootViewController"]}`)
//         return ret
//     }, "pointer", ["pointer", "pointer", "pointer"]))
//     Interceptor.attach(ObjC.classes["FlutterAppDelegate"]["- init"].implementation, {
//         onEnter(args) {
//             const obj = new ObjC.Object(args[0])
//             console.warn(`\nCalled FlutterAppDelegate init:'${obj}'`)
//             this.ins = args[0]
//         },
//         onLeave(retval) {
//         },
//     })
//     var target_method = ObjC.classes["Runner.AppDelegate"]["- application:didFinishLaunchingWithOptions:"]
//     var old_impl = target_method.implementation
//     target_method.implementation = ObjC.implement(target_method, function (_instance, s, s1, launchOptions) {
//         let ret = old_impl(_instance, s, s1, launchOptions)
//         const instance = new ObjC.Object(_instance)
//         console.log(`\nCalled didFinishLaunchingWithOptions:'${instance}' launchOptions:'${launchOptions}'`)
//         console.log(`${instance.$ivars["_window"].$ivars["_rootViewController"]}`)
//         instance.$ivars["_window"].$ivars["_rootViewController"] = ObjC.classes["Runner.NRViewController"]["new"]()
//         console.log(`${instance.$ivars["_window"].$ivars["_rootViewController"]}`)
//         return ret
//     })
// })
✄
{"version":3,"file":"button.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/oc/button.ts"],"names":[],"mappings":"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"}
✄
// typedef NS_OPTIONS(NSUInteger, UIControlEvents) {
//     UIControlEventTouchDown                                         = 1 <<  0,      // on all touch downs
//     UIControlEventTouchDownRepeat                                   = 1 <<  1,      // on multiple touchdowns (tap count > 1)
//     UIControlEventTouchDragInside                                   = 1 <<  2,
//     UIControlEventTouchDragOutside                                  = 1 <<  3,
//     UIControlEventTouchDragEnter                                    = 1 <<  4,
//     UIControlEventTouchDragExit                                     = 1 <<  5,
//     UIControlEventTouchUpInside                                     = 1 <<  6,
//     UIControlEventTouchUpOutside                                    = 1 <<  7,
//     UIControlEventTouchCancel                                       = 1 <<  8,
//     UIControlEventValueChanged                                      = 1 << 12,     // sliders, etc.
//     UIControlEventPrimaryActionTriggered API_AVAILABLE(ios(9.0))    = 1 << 13,     // semantic action: for buttons, etc.
//     UIControlEventMenuActionTriggered API_AVAILABLE(ios(14.0))      = 1 << 14,     // triggered when the menu gesture fires but before the menu presents
//     UIControlEventEditingDidBegin                                   = 1 << 16,     // UITextField
//     UIControlEventEditingChanged                                    = 1 << 17,
//     UIControlEventEditingDidEnd                                     = 1 << 18,
//     UIControlEventEditingDidEndOnExit                               = 1 << 19,     // 'return key' ending editing
//     UIControlEventAllTouchEvents                                    = 0x00000FFF,  // for touch events
//     UIControlEventAllEditingEvents                                  = 0x000F0000,  // for UITextField
//     UIControlEventApplicationReserved                               = 0x0F000000,  // range available for application use
//     UIControlEventSystemReserved                                    = 0xF0000000,  // range reserved for internal framework use
//     UIControlEventAllEvents                                         = 0xFFFFFFFF
// };
var UIControlEvents;
(function (UIControlEvents) {
    UIControlEvents[UIControlEvents["UNDEF"] = 0] = "UNDEF";
    UIControlEvents[UIControlEvents["EventTouchDown"] = 1] = "EventTouchDown";
    UIControlEvents[UIControlEvents["EventTouchDownRepeat"] = 2] = "EventTouchDownRepeat";
    UIControlEvents[UIControlEvents["EventTouchDragInside"] = 4] = "EventTouchDragInside";
    UIControlEvents[UIControlEvents["EventTouchDragOutside"] = 8] = "EventTouchDragOutside";
    UIControlEvents[UIControlEvents["EventTouchDragEnter"] = 16] = "EventTouchDragEnter";
    UIControlEvents[UIControlEvents["EventTouchDragExit"] = 32] = "EventTouchDragExit";
    UIControlEvents[UIControlEvents["EventTouchUpInside"] = 64] = "EventTouchUpInside";
    UIControlEvents[UIControlEvents["EventTouchUpOutside"] = 128] = "EventTouchUpOutside";
    UIControlEvents[UIControlEvents["EventTouchCancel"] = 256] = "EventTouchCancel";
    UIControlEvents[UIControlEvents["EventValueChanged"] = 4096] = "EventValueChanged";
    UIControlEvents[UIControlEvents["EventPrimaryActionTriggered"] = 8192] = "EventPrimaryActionTriggered";
    UIControlEvents[UIControlEvents["EventMenuActionTriggered"] = 16384] = "EventMenuActionTriggered";
    UIControlEvents[UIControlEvents["EventEditingDidBegin"] = 65536] = "EventEditingDidBegin";
    UIControlEvents[UIControlEvents["EventEditingChanged"] = 131072] = "EventEditingChanged";
    UIControlEvents[UIControlEvents["EventEditingDidEnd"] = 262144] = "EventEditingDidEnd";
    UIControlEvents[UIControlEvents["EventEditingDidEndOnExit"] = 524288] = "EventEditingDidEndOnExit";
    UIControlEvents[UIControlEvents["EventAllTouchEvents"] = 4095] = "EventAllTouchEvents";
    UIControlEvents[UIControlEvents["EventAllEditingEvents"] = 983040] = "EventAllEditingEvents";
    UIControlEvents[UIControlEvents["EventApplicationReserved"] = 251658240] = "EventApplicationReserved";
    UIControlEvents[UIControlEvents["EventSystemReserved"] = 4026531840] = "EventSystemReserved";
    UIControlEvents[UIControlEvents["EventAllEvents"] = 4294967295] = "EventAllEvents";
})(UIControlEvents || (UIControlEvents = {}));
// iVar        Value
// ----------  -------------------------
// isa         {'handle': '0x203101748'}
// _target     {'handle': '0x13f111ff0'}
// _action     0x1044ba8a0
// _eventMask  64
// _cancelled  False
class UIControlTargetAction {
    constructor(ptr) {
        this.isa = NULL;
        this._target = NULL;
        this._action = NULL;
        this._eventMask = UIControlEvents.UNDEF;
        this._cancelled = false;
        this.isa = ptr.readPointer();
        this._target = ptr.add(1 * Process.pointerSize).readPointer();
        this._action = ptr.add(2 * Process.pointerSize).readPointer();
        this._eventMask = ptr.add(3 * Process.pointerSize).readU32();
        this._cancelled = ptr.add(3 * Process.pointerSize + 4).readU8() != 0;
        this._target_ins = new ObjC.Object(this._target);
        this._action_str = this._action.readCString();
    }
    parseAction() {
        const _fullName = this._target_ins.$methods.filter(i => i.includes(this._action_str))[0];
        const _action_method = this._target_ins.$class[_fullName];
        return `${ptr(_action_method)} -> ${_action_method.implementation}`;
    }
    toString() {
        return `target: ${this._target_ins}\n\taction: ${this._action} | '${this._action_str}' | ${this.parseAction()}\n\teventMask: ${this._eventMask}, cancelled: ${this._cancelled}`;
    }
}
const showButtonActions = (ptr) => {
    const mPtr = checkPointer(ptr);
    let obj = new ObjC.Object(mPtr);
    if (!getSuperClasses(mPtr).map(i => i.$className).includes("UIButton")) {
        // UIButtonLabel props ↓
        // UIButtonLabel extends UILabel ? Four new member variables have been added ?
        // ......
        // [68] _reverseShadow: | boolean
        //         false
        // [69] _button: | ObjC.Object <- instance of UPXCommonButton @ 0x1060b72b0
        //         0x107da0cc0
        // [70] _cachedDefaultAttributes: | ObjC.Object <- instance of __NSDictionaryM @ 0x1dc788050
        //         0x2820daee0
        // [71] _fontIsDefaultForIdiom: | boolean
        //         false
        if (getFields(mPtr).includes("_button")) {
            obj = obj.$ivars["_button"];
        }
        else {
            throw new Error(`pointer --//--> class extends UIButton ${ObjC.classes['UIButton']} ? C:${obj}`);
        }
    }
    const actions = obj.$ivars["_targetActions"];
    if (actions.isNull())
        throw new Error(`targetActions == ${actions} }`);
    const count = actions["- count"]();
    for (let i = 0; i < count; i++) {
        const item_obj = actions["- objectAtIndex:"](i);
        const item = new UIControlTargetAction(item_obj.handle);
        logd(`[${i}] ${item}`);
    }
};
globalThis.showButtonActions = showButtonActions;
export {};
✄
{"version":3,"file":"clazz.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/oc/clazz.ts"],"names":[],"mappings":"AAAA,MAAM,OAAO,aAAc,SAAQ,IAAI,CAAC,MAAM;IAE1C,YAAY,IAAkB;QAC1B,KAAK,CAAC,IAAI,CAAC,CAAA;QACX,IAAI,IAAI,CAAC,KAAK,IAAI,YAAY;YAAE,MAAM,IAAI,KAAK,CAAC,4CAA4C,IAAI,CAAC,KAAK,EAAE,CAAC,CAAA;IAC7G,CAAC;IAED,IAAI,IAAI;QACJ,OAAO,IAAI,CAAC,UAAU,CAAA;IAC1B,CAAC;IAEM,OAAO;QACV,OAAO,IAAI,CAAC,UAAU,CAAA;IAC1B,CAAC;IAEM,QAAQ;QACX,OAAO,MAAM,IAAI,CAAC,cAAc,IAAI,IAAI,EAAE,CAAA;IAC9C,CAAC;CACJ;AAaD,UAAU,CAAC,IAAI,CAAC,KAAK,GAAG,aAAa,CAAA;AACrC,yEAAyE;AAEzE,+DAA+D;AAC/D,2CAA2C;AAC3C,sBAAsB;AACtB,QAAQ;AACR,KAAK"}
✄
export class ObjCClassIMPL extends ObjC.Object {
    constructor(mPtr) {
        super(mPtr);
        if (this.$kind == "meta-class")
            throw new Error(`this ptr can not cast to class | current:${this.$kind}`);
    }
    get name() {
        return this.$className;
    }
    getName() {
        return this.$className;
    }
    toString() {
        return `C: ${this.implementation} ${this}`;
    }
}
globalThis.ObjC.Class = ObjCClassIMPL;
// Reflect.setPrototypeOf(ObjCClassIMPL.prototype, ObjC.Object.prototype)
// Object.defineProperty(ObjCClassIMPL.prototype, "toString", {
//     value: function toString(): string {
//         return `C:`
//     }
// })
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/oc/include.ts"],"names":[],"mappings":"AAAA,OAAO,YAAY,CAAA;AACnB,OAAO,aAAa,CAAA;AACpB,OAAO,SAAS,CAAA;AAEhB,OAAO,aAAa,CAAA;AACpB,OAAO,qBAAqB,CAAA;AAE5B,OAAO,oBAAoB,CAAA"}
✄
import './clazz.js';
import './method.js';
import './oc.js';
import './button.js';
import './ViewController.js';
import './types/include.js';
✄
{"version":3,"file":"method.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/oc/method.ts"],"names":[],"mappings":"AAAA,MAAM,OAAO,cAAe,SAAQ,IAAI,CAAC,MAAM;IAE3C,QAAQ;QACJ,OAAO,MAAM,IAAI,CAAC,cAAc,IAAI,IAAI,EAAE,CAAA;IAC9C,CAAC;IAED,IAAI,GAAG;QACH,OAAO,IAAI,CAAC,cAAc,CAAA;IAC9B,CAAC;CAEJ;AAYD,UAAU,CAAC,IAAI,CAAC,MAAM,GAAG,cAAc,CAAA"}
✄
export class ObjCMethodIMPL extends ObjC.Object {
    toString() {
        return `C: ${this.implementation} ${this}`;
    }
    get ptr() {
        return this.implememtation;
    }
}
globalThis.ObjC.Method = ObjCMethodIMPL;
✄
{"version":3,"file":"oc.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/oc/oc.ts"],"names":[],"mappings":"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"}
✄
var cacheAllClass = [];
globalThis.cacheAllClass = cacheAllClass;
const getCachedClasses = () => {
    if (cacheAllClass.length === 0)
        cacheAllClass = Object.values(ObjC.classes);
    return cacheAllClass;
};
// findMethodsByResolver("-[* *Jail*]")
// findMethodsByResolver("-[NSString *stringWith*]")
globalThis.findMethodsByResolver = (query) => {
    if (query == null)
        throw new Error("query cannot be null");
    let count = 0;
    new ApiResolver("objc")
        .enumerateMatches(query)
        .forEach((m) => logd(`[ ${count++} ]\t${m.address}\t${m.name}`));
};
const getClassFromMethodName = (name, filterClass) => {
    let cls;
    for (let i = 0; i < filterClass.length; i++) {
        cls = filterClass[i];
        if (cls[name])
            return cls;
    }
};
globalThis.showMethods = (clsNameOrPtr, filter = '', includeParent = false) => {
    const obj = new ObjC.Object(checkPointer(clsNameOrPtr));
    logw(`\nDisplay methods of ${obj.$className} @ ${obj.$class.handle}`);
    try {
        const debugSym = DebugSymbol.fromAddress(obj.$class.handle);
        const md = Process.findModuleByName(debugSym.moduleName);
        logz(`${debugSym.name} IN ${debugSym.moduleName} [ ${md?.path} ${ptr(md?.size)} ]`);
    }
    catch (error) { }
    showSuperClasses(obj);
    // const supClasses = getSuperClasses(obj)
    let count = 0;
    {
        (() => { return includeParent ? obj.$methods : obj.$ownMethods; })()
            .filter(m => filter.length == 0 ? true : m.includes(filter))
            .sort((i1, i2) => i2.localeCompare(i1))
            .map((m, i) => {
            count = i;
            try {
                // !todo 在 includeParent 启用的时候 分组展示类方法
                // const extra = "C: " + (includeParent ? `${getClassFromMethodName(m, supClasses)?.$class.handle}` : '')
                const _extra = '';
                // class methods
                const method = obj.$class[m];
                const impl = method.implementation;
                const md = Process.findModuleByAddress(impl);
                let extraDes = "-> ";
                try {
                    // after objc.implement, An error will be triggered here.
                    const rva = String(impl.sub(md?.base)).padEnd(11, ' ');
                    extraDes += `${rva} `;
                }
                catch (error) {
                    extraDes = '';
                }
                return `[ ${i} ]\t M: ${ptr(method)} -> ${impl} ${extraDes} | ${m}`;
            }
            catch (error) {
                // instance methods
                const selector = call("NSSelectorFromString", allocOCString(m.substring(m.indexOf(' ') + 1)));
                const method = call("class_getInstanceMethod", obj, selector);
                const impl = call("method_getImplementation", method);
                const md = Process.findModuleByAddress(impl);
                let extraDes = "-> ";
                try {
                    // after objc.implement, An error will be triggered here.
                    const rva = String(impl.sub(md?.base)).padEnd(11, ' ');
                    extraDes += `${rva} `;
                }
                catch (error) {
                    extraDes = '';
                }
                return `[ ${i} ]\t M: ${method} -> ${impl} ${extraDes}| ${m}`;
            }
        })
            .forEach((item, i) => item.includes(' _') ? logz(item) : logd(item));
    }
    logn(`\n{ F:${count + 1} / A:${obj.$methods.length} }\n`);
};
globalThis.findMethods = (query, className, accurate = false) => {
    if (query == null)
        throw new Error("query cannot be null");
    let count = 0;
    if (!className) {
        getCachedClasses().forEach(cls => ItorClassMethods(cls, query, accurate));
    }
    else {
        ItorClassMethods(ObjC.classes[className], query, accurate);
    }
    newLine();
    function ItorClassMethods(cls, query, accurate) {
        const methods = cls.$methods.filter((m) => accurate ? m == query : m.includes(query));
        if (methods.length != 0)
            logw(`\n[!] ${cls.handle} | ${methods.length} | ${cls.$className} \n`);
        else
            throw new Error(`class methods len = ${cls.$methods} ... after Fileter ${methods.length}`);
        methods
            .map((m, i) => {
            try {
                // class methods
                const method = cls.$class[m];
                const impl = method.implementation; // throw error while type of class is instance
                const md = Process.findModuleByAddress(impl);
                let extraDes = "-> ";
                try {
                    // after objc.implement, An error will be triggered here.
                    const rva = String(impl.sub(md?.base)).padEnd(11, ' ');
                    extraDes += `${rva} `;
                }
                catch (error) {
                    extraDes = '';
                }
                return `[ ${i} ]\t M: ${ptr(method)} -> ${impl} ${extraDes} | ${m}`;
            }
            catch (error) {
                // instance methods
                const selector = call("NSSelectorFromString", allocOCString(m.substring(m.indexOf(' ') + 1)));
                const method = call("class_getInstanceMethod", cls, selector);
                const impl = call("method_getImplementation", method);
                const md = Process.findModuleByAddress(impl);
                let extraDes = "-> ";
                try {
                    // after objc.implement, An error will be triggered here.
                    const rva = String(impl.sub(md?.base)).padEnd(11, ' ');
                    extraDes += `${rva} `;
                }
                catch (error) {
                    extraDes = '';
                }
                return `[ ${i} ]\t M: ${method} -> ${impl} ${extraDes} | ${m}`;
            }
        })
            .sort((a, b) => b[0].localeCompare(a[0]))
            .map(m => `[ ${count++} ]\t${m}`)
            .forEach(logd);
    }
};
globalThis.findClasses = (query, accurate = false) => {
    if (query == null)
        throw new Error("query cannot be null");
    newLine();
    let count = 0;
    // 不全
    // ObjC.enumerateLoadedClasses({
    //     onMatch(name: string, owner: string) {
    //         if (accurate ? name == query : name.includes(query))
    //             logd(`[ ${count++} ] ${ObjC.classes[name].$class.handle} ${name} ${owner}`)
    //     },
    //     onComplete() {
    //         logw(`\n[findClasses] onComplete | [ ${count} ]\n`)
    //     }
    // })
    getCachedClasses()
        .filter(cls => accurate ? cls.$className == query : cls.$className.includes(query))
        .forEach(cls => {
        logd(`[ ${count++} ]\t${cls.$class.handle}  ${cls.$className}`);
        const md = Process.findModuleByName(cls.$moduleName);
        logz(`\t${md?.base} ${ptr(md?.size)} \t ${cls.$moduleName}`);
    });
    newLine();
};
globalThis.getSuperClasses = (ptr) => {
    const obj = new ObjC.Object(checkPointer(ptr));
    let cls_itor = obj;
    let arr = [cls_itor];
    while (true) {
        try {
            if (cls_itor.isNull() || cls_itor.handle.isNull())
                break;
            cls_itor = cls_itor.$superClass;
            if (cls_itor != null)
                arr.push(cls_itor);
        }
        catch (error) {
            break;
        }
    }
    return arr;
};
const showSuperClasses = (ptr) => {
    const arr = getSuperClasses(checkPointer(ptr));
    let disp = '';
    try {
        for (let i = 0; i < arr.length; i++) {
            disp += arr[i].$className;
            disp += ` ( ${arr[i].$class.handle} ) `;
            if (i < arr.length - 1)
                disp += ' -> ';
        }
    }
    catch (error) {
        // ...
    }
    logd(`\n${disp}\n`);
};
const showSubClasses = (ptr) => {
    const cur = new ObjC.Object(checkPointer(ptr));
    logw(`\nDisplay sub classes of ${cur.$className} @ ${cur.$class.handle} \n`);
    getCachedClasses()
        .filter(item => {
        const sup = item.$superClass;
        if (sup == undefined || sup == null)
            return false;
        return sup.equals(cur.$class);
    })
        .sort((a, b) => a.$className.localeCompare(b.$className))
        .forEach((item, index) => {
        const disp = `[ ${index} ]\t${item.$class.handle} -> ${item.$className}`;
        item.$className.startsWith('_') ? logz(disp) : logd(disp);
    });
    newLine();
};
globalThis.m = globalThis.showMethods;
globalThis.showMethod = (method, extName) => {
    let localM = NULL;
    try {
        localM = checkPointer(method);
    }
    catch (error) {
        // try use ApiResolver to find (methodName)
        if (typeof method == "string") {
            let found;
            if (method.includes('[')) {
                found = new ApiResolver("objc").enumerateMatches(method);
            }
            else {
                found = new ApiResolver("objc").enumerateMatches(`*[* ${method}]`);
            }
            if (found != undefined && found != null && found.length != 0) {
                found.forEach(item => showMethod(nameToMethod(item.name).handle, item.name));
            }
            else {
                throw new Error(`Not Found -> ${method}`);
            }
            return;
        }
        else
            throw error;
    }
    logs(getLine(60, '-'));
    // OBJC_EXPORT SEL _Nonnull method_getName(Method _Nonnull m)
    const name = call("method_getName", localM).readCString();
    logd(`Name\t\t\t->\t${name} ${extName == undefined ? '' : ` | ${extName}`}`);
    const argsCount = call("method_getNumberOfArguments", localM).toInt32();
    logd(`NumberOfArguments\t->\t${argsCount}`);
    // OBJC_EXPORT const char * _Nullable method_getTypeEncoding(Method _Nonnull m) 
    const typeEncoding = call("method_getTypeEncoding", localM).readCString();
    logd(`TypeEncoding\t\t->\t${typeEncoding}`);
    // // struct objc_method_description {
    // //     SEL _Nullable name;               /**< The name of the method */
    // //     char * _Nullable types;           /**< The types of the method arguments */
    // // };
    // class objc_method_description {
    //     name: NativePointer
    //     types: NativePointer
    //     constructor(public mPtr: NativePointer) {
    //         this.name = mPtr
    //         this.types = mPtr.add(Process.pointerSize)
    //     }
    //     public toString() {
    //         return `name: ${this.name.readPointer().readCString()} types: ${this.types.readPointer().readCString()}`
    //     }
    // }
    // // alias name + types ↓
    // const description = new objc_method_description(call("method_getDescription", localM))
    // logd(`Description\t\t->\t${description}`)
    logd(`ObjectMethod\t\t->\t${localM}`);
    // OBJC_EXPORT IMP _Nonnull method_getImplementation(Method _Nonnull m) 
    const implementation = call("method_getImplementation", localM);
    let extraDes;
    try {
        const md = Process.findModuleByAddress(implementation);
        let rva = '';
        // if (md == null) {
        //     rva = `${OC_Hook_Status.getNewImplFromOCMethod(localM)} [R]`
        // } else {
        rva = `${implementation.sub(md.base)}`;
        // }
        extraDes = `| ${rva} `;
        logd(`Implementation\t\t->\t${implementation} ${extraDes}`);
    }
    catch (error) {
        // already modify
        extraDes = '';
        logz(`Implementation\t\t->\t${implementation} ${extraDes}`);
    }
    const pk = getArgsAndRet(localM);
    logd(`ReturnType`);
    logd(`\tret: \t\t${pk.ret} - ${parseType(pk.ret)}`);
    logd('ArgumentTypes');
    pk.args.forEach((item, index) => logd(`\targs[${index}]:\t${item} - ${parseType(item)}`));
};
export const packArgs = (arg, type) => {
    // todo
    switch (type) {
        case "string": return arg.readCString() == null ? "" : arg.readCString();
        case "class": return new ObjC.Object(arg).toString();
        case "object": return new ObjC.Object(arg).toString();
        case "selector": return ObjC.selectorAsString(arg);
        case "bool": return `${arg} => ${new Boolean(arg).toString()}`;
        case "void": '';
        default: return `${arg}`;
    }
};
export const getArgsAndRet = (method) => {
    let packArgsAndRet = { ret: "", args: [] };
    // OBJC_EXPORT char * _Nonnull method_copyReturnType(Method _Nonnull m) 
    // OBJC_EXPORT void method_getReturnType(Method _Nonnull m, char * _Nonnull dst, size_t dst_len) 
    const dst_len = 0x20;
    const dst_ptr = Memory.alloc(dst_len);
    call("method_getReturnType", method, dst_ptr, dst_len);
    const type = dst_ptr.readCString();
    packArgsAndRet.ret = type;
    dst_ptr.writeByteArray(Array.from(new Uint8Array(dst_len)));
    // OBJC_EXPORT char * _Nullable method_copyArgumentType(Method _Nonnull m, unsigned int index) 
    // OBJC_EXPORT void method_getArgumentType(Method _Nonnull m, unsigned int index, char * _Nullable dst, size_t dst_len) 
    for (let i = 0; i < call("method_getNumberOfArguments", method).toInt32(); i++) {
        try {
            dst_ptr.writeByteArray(Array.from(new Uint8Array(dst_len)));
            call("method_getArgumentType", method, i, dst_ptr, dst_len);
            packArgsAndRet.args[i] = dst_ptr.readCString();
        }
        catch (error) {
            if (i == 0)
                packArgsAndRet.args[0] = "@";
            else
                throw error;
        }
    }
    return packArgsAndRet;
};
/**
 * parse type to string
 * @param typeStr type string
 * @param toDisplay disp(default) or fridaType
 * @returns
 */
export const parseType = (typeStr, toDisplay = true) => {
    const idByAlias = {
        'c': 'char',
        'i': 'int',
        's': 'int16',
        'q': 'int64',
        'C': 'uchar',
        'I': 'uint',
        'S': 'uint16',
        'Q': 'uint64',
        'f': 'float',
        'd': 'double',
        'B': 'bool',
        'b': 'bool',
        'v': 'void',
        '*': 'string',
        '@': 'object',
        '@?': 'block',
        '#': 'class',
        ':': 'selector',
        '^v': 'pointer' // void *
    };
    const fridaTypeExt = {
        'BOOL': 'bool',
        'object': 'pointer',
        'block': 'pointer',
        'class': 'pointer',
        'selector': 'pointer'
    };
    if (typeStr == null || typeStr == undefined)
        return '';
    if (toDisplay) {
        // to display
        if (typeStr in idByAlias)
            return idByAlias[typeStr];
        if (typeStr.startsWith("{"))
            return "struct";
        // throw new Error(`Type case not impl ? ${typeStr}`)
        return `${typeStr} <- parse error`;
    }
    else {
        // to frida type
        if (typeStr in idByAlias) {
            const ret = idByAlias[typeStr];
            const ret_case = fridaTypeExt[ret];
            return ret_case == undefined ? ret : ret_case;
        }
        // throw new Error(`Type case not impl ? ${typeStr}`)
        return `pointer`;
    }
};
globalThis.getFields = (cls) => {
    const localCls = checkPointer(cls);
    const ObjCls = new ObjC.Object(localCls);
    let fields = new Array();
    for (const k in ObjCls.$ivars) {
        fields.push(k);
    }
    return fields;
};
// cls can be instanceof ObjC.ObjC or Class(OC MetaClass)
const listFields = (cls) => getFields(cls).forEach(logd);
globalThis.f = listFields;
/**
 * get method impl
 * @param className
 * @param methodName
 * @returns impl / not Method
 */
globalThis.lookupMethod = (className, methodName) => {
    // this two api available ↓
    try {
        // (void*)class_lookupMethod((Class)NSClassFromString(@"Counter"), (SEL)NSSelectorFromString(@"setTestStr:"));
        const clz = call("NSClassFromString", allocOCString(className));
        if (clz.isNull())
            throw new Error(`class ${className} not found`);
        const sel = call("NSSelectorFromString", allocOCString(methodName));
        if (sel.isNull())
            throw new Error(`error: get selector ${methodName}`);
        const impl = call("class_lookupMethod", clz, sel);
        if (impl.isNull())
            throw new Error(`class ${className} method ${methodName} not found`);
        return impl;
    }
    catch (error) {
        // OBJC_EXPORT IMP _Nullable class_getMethodImplementation(Class _Nullable cls, SEL _Nonnull name) 
        const clz = call("objc_getClass", allocCString(className));
        if (clz.isNull())
            throw new Error(`class ${className} not found`);
        const sel = call("NSSelectorFromString", allocOCString(methodName));
        if (sel.isNull())
            throw new Error(`error: get selector ${methodName}`);
        const impl = call("class_getMethodImplementation", clz, sel);
        if (impl.isNull())
            throw new Error(`class ${className} method ${methodName} not found`);
        return impl;
    }
};
const watch_getClass = () => {
    // todo
    // OBJC_EXPORT void objc_setHook_getClass(objc_hook_getClass _Nonnull newValue, objc_hook_getClass _Nullable * _Nonnull outOldValue)
};
globalThis.showSuperClasses = showSuperClasses;
globalThis.getSuperClasses = getSuperClasses;
globalThis.showSubClasses = showSubClasses;
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/oc/types/include.ts"],"names":[],"mappings":"AAAA,OAAO,kBAAkB,CAAA"}
✄
import './objc_method.js';
✄
{"version":3,"file":"objc_method.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/oc/types/objc_method.ts"],"names":[],"mappings":"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"}
✄
import { getArgsAndRet, packArgs, parseType } from "../oc.js";
import { HK_TYPE } from "../../../../utils.js";
export class OC_Hook_Status_IMPL {
    static getNewImplFromOld(oldPtr_) {
        for (const [_key, value] of OC_Hook_Status.mapSrcToNewImpl) {
            if (value.oldPtr.equals(oldPtr_))
                return value.newPtr;
        }
        return NULL;
    }
    static getNewImplFromOCMethod(objcMethod) {
        return OC_Hook_Status.mapSrcToNewImpl.get(objcMethod)?.oldPtr;
    }
    static addNew(objcMethod, newPtr, oldPtr) {
        OC_Hook_Status.mapSrcToNewImpl.set(objcMethod, { newPtr: newPtr, oldPtr: oldPtr });
    }
    static has(objcMethod) {
        for (const [key, _value] of OC_Hook_Status.mapSrcToNewImpl) {
            if (key.handle == objcMethod)
                return true;
        }
        return false;
    }
    static disp() {
        let index = 0;
        newLine();
        for (const [key, value] of OC_Hook_Status.mapSrcToNewImpl) {
            let objM = key;
            logd(`[${index++}] \tobjcMethod:${objM.handle} => { newPtr:${value.newPtr}, oldPtr:${value.oldPtr} }`);
        }
        newLine();
    }
}
// global map save srcImpl to modifyImpl ptr
OC_Hook_Status_IMPL.mapSrcToNewImpl = new Map();
class objc_method_local {
    constructor(mPtr, methodName) {
        this.PTR_SEL = NULL;
        this.PTR_TYPES = NULL;
        this.PTR_IMPL = NULL;
        let localP = NULL;
        if (mPtr != undefined && methodName == undefined) {
            if (mPtr instanceof NativePointer || typeof mPtr === 'number' || (typeof mPtr === 'string' && mPtr.trim().startsWith('0x'))) {
                localP = mPtr instanceof NativePointer ? mPtr : ptr(mPtr);
                try {
                    const impl = localP.add(Process.pointerSize * 2).readPointer();
                    this.methodFHandle = addressToMethod(impl);
                }
                catch (error) { }
            }
            else
                throw new Error('Invalid argument');
        }
        else if (methodName != undefined && typeof mPtr === 'string') {
            this.methodFHandle = ObjC.classes[mPtr][methodName];
            localP = this.methodFHandle.handle;
        }
        else {
            throw new Error('Invalid argument');
        }
        this.PTR_SEL = localP;
        this.PTR_TYPES = localP.add(Process.pointerSize);
        this.PTR_IMPL = localP.add(Process.pointerSize * 2);
    }
    get address() { return this.PTR_IMPL.readPointer(); }
    get rva() {
        const md = Process.findModuleByAddress(this.address);
        return this.address.sub(md?.base);
    }
    get sel_ptr() { return this.PTR_SEL.readPointer(); }
    get sel() { return ObjC.selectorAsString(this.sel_ptr); }
    get types() {
        return this.methodFHandle ?
            this.methodFHandle.types :
            this.PTR_TYPES.readPointer().readCString();
    }
    get argsCount() {
        return this.methodFHandle ?
            this.methodFHandle.argumentTypes.length :
            call("method_getNumberOfArguments", this.PTR_SEL).toInt32();
    }
    // public invoke(...args: any[]) {
    //     if (!this.methodFHandle) throw new Error('Missing impl method call')
    //     if (args.length != this.argsCount - 2) throw new Error(`Invalid argument count [ expected ${this.argsCount - 2} but got ${args.length} ]`)
    //     return this.methodFHandle(...args)
    //     // return this.methodFHandle(Memory.allocUtf8String("test"))
    //     // return call(ObjC.api.objc_msgSend, this.methodFHandle.handle, this.sel_ptr, ...args.map(x => ptr(x as any)))
    // }
    toString() { return `${this.PTR_SEL} -> ${this.address} -> ${this.rva} | ${this.sel} (${this.types})`; }
    get HookType() {
        return HK_TYPE.OBJC_REP;
    }
    hook(hooktype = this.HookType, passPrivate = true, defaultArgsC = 6, force = false) {
        // if ((hooktype == HK_TYPE.FRIDA_ATTACH || hooktype == HK_TYPE.FRIDA_REP) && !force) {
        if (!force) {
            if (passPrivate && this.sel.startsWith('_')) {
                logw(`hooking ${this.address} -> ${this.sel} | pass private method`);
                return;
            }
            if (this.sel.includes("alloc") || this.sel.includes("description")) {
                logw(`hooking ${this.address} -> ${this.sel} | pass filter method`);
                return;
            }
        }
        switch (hooktype) {
            case HK_TYPE.FRIDA_ATTACH:
                const argsCount = this.argsCount;
                try {
                    A(this.address, (args) => {
                        const argsStr = Array.from({ length: argsCount }, (_, i) => args[i].toString()).join(', ');
                        logd(`[ ${++objc_method_local.count} ]\tcalled ${argsStr}`);
                    });
                    logd(`hooking ${this.address} -> ${this.sel}`);
                }
                catch (error) {
                    loge(`hooking ${this.address} -> ${this.sel} | Error: ${error}`);
                }
                break;
            case HK_TYPE.FRIDA_REP:
                let argsT;
                if (this.methodFHandle) {
                    argsT = eval(`[ ${this.methodFHandle?.argumentTypes.map(i => `"${i}"`)} ]`);
                }
                else {
                    argsT = eval(`[ ${Array.from({ length: defaultArgsC }, (_, _i) => `"pointer"`).join(', ')} ]`);
                }
                try {
                    const srcCall = new NativeFunction(this.address, 'pointer', argsT);
                    Interceptor.revert(this.address);
                    logz(`${this.sel} ${argsT}`);
                    Interceptor.replace(this.address, new NativeCallback(function (...args) {
                        let ret = srcCall(...arguments);
                        const argsStr = args.map((i, c) => {
                            const il = i;
                            if (c == 0)
                                return `${new ObjC.Object(il)} @ ${il}`;
                            if (c == 1)
                                return ObjC.selectorAsString(il);
                            return ptr(i);
                        }).join(', ');
                        logd(`[ ${++objc_method_local.count} ]\tcalled ${argsStr}`);
                        return ret;
                    }, 'pointer', argsT));
                    logd(`hooking ${this.address} -> ${this.sel}`);
                }
                catch (error) {
                    loge(`hooking ${this.address} -> ${this.sel} | Error: ${error}`);
                }
                break;
            case HK_TYPE.OBJC_REP:
                const method = this.methodFHandle;
                if (method == undefined) {
                    // return loge(`${this.address} -> ${this.sel} | Error: ObjMethod is NULL`)
                    return loge(`${this.address} -> ${this.sel} | Error: already replaced`);
                }
                const old_impl = method.implementation;
                try {
                    const new_impl = ObjC.implement(method, function (clazz, selector, ...args) {
                        const ret = old_impl(clazz, selector, ...args);
                        const argsStr = args.map((i, _c) => i).join(', ');
                        const pk = getArgsAndRet(method.handle);
                        logd(`[ ${++objc_method_local.count} ]\tcalled ${new ObjC.Object(clazz)} @ ${clazz}, ${ObjC.selectorAsString(selector)} ${argsStr}`);
                        const retType = parseType(pk.ret);
                        if (retType != "void") {
                            let extInfo = retType;
                            if (retType == "object") {
                                const retObj = new ObjC.Object(ret);
                                extInfo = `${retObj.$kind} of ${retObj.$className} @ ${retObj.$class.handle}`;
                            }
                            logz(`retval  ${extInfo}\t${packArgs(ret, retType)}`);
                        }
                        for (let i = 0; i < pk.args.length - 2; i++) {
                            try {
                                const typeName = parseType(pk.args[i + 2]);
                                let extInfo = typeName;
                                if (typeName == "object") {
                                    const obj = new ObjC.Object(args[i]);
                                    extInfo = `{ ${obj.$kind} of ${obj.$className} @ ${obj.$class.handle} }`;
                                }
                                logz(`args[${i}] ${extInfo}\t${packArgs(args[i], typeName)}`);
                            }
                            catch (error) {
                                loge(error);
                            }
                        }
                        return ret;
                    });
                    method.implementation = new_impl;
                    OC_Hook_Status.addNew(method, new_impl, old_impl);
                    logg(`hooking objM:${method.handle} ptr:${old_impl} new:${new_impl} -> ${this.sel}`);
                }
                catch (error) {
                    loge(`hooking objM:${method.handle} ptr:${old_impl} -> ${this.sel} \nError: ${error}`);
                }
                break;
            default:
                throw new Error(`ERROR HookType`);
        }
    }
    detachOC() {
    }
}
objc_method_local.count = 0;
globalThis.objc_method = objc_method_local;
globalThis.OC_Hook_Status = OC_Hook_Status_IMPL;
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/swift/include.ts"],"names":[],"mappings":"AAAA,OAAO,WAAW,CAAA"}
✄
import './main.js';
✄
{"version":3,"file":"main.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/lang/swift/main.ts"],"names":[],"mappings":""}
✄
export {};
✄
{"version":3,"file":"include.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/service/include.ts"],"names":[],"mappings":"AAAA,OAAO,WAAW,CAAA"}
✄
import './main.js';
✄
{"version":3,"file":"main.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/plugin/service/main.ts"],"names":[],"mappings":"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"}
✄
setImmediate(() => {
    return;
    B_NSLOG();
    const addr_IOObjectConformsTo = DebugSymbol.fromName("IOObjectConformsTo").address;
    const func_IOObjectConformsTo = new NativeFunction(addr_IOObjectConformsTo, 'int', ['pointer', 'pointer']);
    const addr_IORegistryEntryGetName = Module.getExportByName(null, "IORegistryEntryGetName");
    // KERN_SUCCESS 0
    const KERN_SUCCESS = 0;
    const cstr_IOWatchdog = allocCString("IOWatchdog");
    let gIOWatchdogConnection = NULL;
    // kern_return_t IOServiceOpen(io_service_t service, task_port_t owningTask, uint32_t type, io_connect_t *connect)
    const addr_IOServiceOpen = DebugSymbol.fromName("IOServiceOpen").address;
    Interceptor.replace(addr_IOServiceOpen, new NativeCallback((service, owningTask, type, connect) => {
        const originalFunction = new NativeFunction(addr_IOServiceOpen, 'int', ['pointer', 'pointer', 'uint', 'pointer']);
        const result = originalFunction(service, owningTask, type, connect);
        const nameBuffer = Memory.alloc(512);
        const length = 512;
        const IORegistryEntryGetName = new NativeFunction(addr_IORegistryEntryGetName, 'int', ['pointer', 'pointer', 'uint32']);
        if (IORegistryEntryGetName(service, nameBuffer, length) === KERN_SUCCESS) {
            const serviceName = nameBuffer.readUtf8String();
            logd(`Service Name: ${serviceName}`);
        }
        else {
            loge("Failed to get the service name");
        }
        logd(`Called IOServiceOpen ${service} ${owningTask} ${type} ${connect}`);
        if (result === KERN_SUCCESS && !connect.readPointer().isNull()) {
            if (func_IOObjectConformsTo(service, cstr_IOWatchdog)) {
                logw('got IOWatchdog');
                gIOWatchdogConnection = connect.readPointer();
            }
            else {
                logd('pass');
            }
        }
        return result;
    }, 'int', ['pointer', 'pointer', 'uint', 'pointer']));
    const addr_IOConnectCallStructMethod = DebugSymbol.fromName("IOConnectCallStructMethod").address;
    // kern_return_t IOConnectCallStructMethod(mach_port_t connection, uint32_t selector, const void *inputStruct, size_t inputStructCnt, void *outputStruct, size_t *outputStructCnt)
    const originalFunction = new NativeFunction(addr_IOConnectCallStructMethod, 'int', ['pointer', 'uint', 'pointer', 'ulong', 'pointer', 'pointer']);
    Interceptor.replace(addr_IOConnectCallStructMethod, new NativeCallback((connection, selector, inputStruct, inputStructCnt, outputStruct, outputStructCnt) => {
        console.log(`called IOConnectCallStructMethod ${connection} ${selector} ${inputStruct}`);
        if (connection.equals(gIOWatchdogConnection)) {
            logw(`connection.equals(gIOWatchdogConnection)`);
            if (selector === 2) {
                logw('connection.equals(gIOWatchdogConnection) and selector == 2');
                return KERN_SUCCESS;
            }
        }
        return originalFunction(connection, selector, inputStruct, inputStructCnt, outputStruct, outputStructCnt);
    }, 'int', ['pointer', 'uint', 'pointer', 'ulong', 'pointer', 'pointer']));
});
✄
{"version":3,"file":"types.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/types.ts"],"names":[],"mappings":""}
✄
export {};
✄
{"version":3,"file":"utils.js","sourceRoot":"/Users/lzy/git_projects/IOSUtils/","sources":["agent/utils.ts"],"names":[],"mappings":"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"}
✄
import { NSUTF8StringEncoding } from './constants.js';
import './types.js';
// ... 单线程的js 这样只会显示最后的结果 ...
// 后续改改创建线程来轮询
export class ProcessDispTask {
    constructor(max = 100, refreshTime = 1000) {
        this._maxProgress = 100;
        this._refreshTime = 200; // ms
        this._currentProgress = 0;
        this._displayTitile = `Progress: `;
        this._processRuning = false; // runing ? 
        this._maxProgress = max;
        this._refreshTime = refreshTime;
        this._currentProgress = 0;
        this.start();
    }
    setMax(max) {
        this._maxProgress = max;
    }
    start() {
        this._processRuning = true;
        this._taskID = setInterval(() => {
            if (this._currentProgress >= this._maxProgress)
                this.stop();
            if (!this._processRuning)
                return;
            console.log('\x1Bc');
            console.warn(`${this._displayTitile} ${this._currentProgress * 100 / this._maxProgress}%\r`);
        }, this._refreshTime);
    }
    stop() {
        clearInterval(this._taskID);
        this._processRuning = false;
        console.log(`${this._displayTitile} ${this._currentProgress * 100 / this._maxProgress}%`);
    }
    update(progress) {
        this._currentProgress = progress;
    }
}
globalThis.ProcessDispTask = ProcessDispTask;
globalThis.clear = () => console.log('\x1Bc');
globalThis.hex = (ptr, len = 0x40) => {
    let mPtr = NULL;
    if (typeof ptr == 'string' && ptr.startsWith("0x"))
        mPtr = new NativePointer(ptr);
    else if (typeof ptr == 'number')
        mPtr = new NativePointer(ptr);
    else if (ptr instanceof NativePointer)
        mPtr = ptr;
    if (mPtr.isNull())
        throw new Error('ptr is null');
    console.log(hexdump(mPtr, { length: len, header: true, ansi: true }));
};
globalThis.dumpUI = () => {
    logd(ObjC.classes.UIWindow.keyWindow().recursiveDescription().toString());
};
globalThis.checkPointer = (ptr, throwErr = true) => {
    let mPtr = NULL;
    if (typeof ptr === 'string') {
        ptr = ptr.trim();
        if (ptr.startsWith('0x')) {
            mPtr = new NativePointer(parseInt(ptr, 16));
        }
        else {
            try {
                mPtr = ObjC.classes[ptr].handle;
            }
            catch { }
            try {
                if (mPtr.isNull())
                    mPtr = DebugSymbol.fromName(ptr).address;
            }
            catch { }
            if (mPtr.isNull()) {
                if (throwErr)
                    throw new Error(`Invalid pointer <- cannot find '${ptr}'`);
                return NULL;
            }
            return mPtr;
        }
    }
    else if (typeof ptr === 'number') {
        mPtr = new NativePointer(ptr);
    }
    else if (ptr instanceof NativePointer) {
        mPtr = ptr;
    }
    else if (ptr instanceof ObjC.Object) {
        mPtr = ptr.handle;
    }
    if (throwErr && mPtr.isNull())
        throw new Error('Invalid pointer');
    return mPtr;
};
globalThis.allocOCString = (str) => {
    if (str == undefined || str.length == 0 || str == null)
        throw new Error('Invalid string');
    return ObjC.classes["NSString"]["+ stringWithUTF8String:"](allocCString(str));
};
globalThis.allocCString = (str) => {
    if (str == undefined || str.length == 0 || str == null)
        throw new Error('Invalid string');
    return Memory.allocUtf8String(str);
};
/**
 *
 * @param ptr function address | asm start address
 * @param args arguments list | if call oc function, instance as first arg, use ObjC.selector or NSSelectorFromString as the secend arg
 * @returns function return value | NativePointer
 * @example
 *
 * new ObjC.selector("xxx") === call("NSSelectorFromString", allocOCString("xxx"))
 *
 * [ UILabel ] 0x102e07840
    UILabel ( 0x20310ec40 )  -> UIView ( 0x20310f668 )  -> UIResponder ( 0x203108f98 )  -> NSObject ( 0x2030ca1f0 )
    [ 0 ]    M: 0x1ba532e80 | - setTextColor:
    [ 1 ]    M: 0x1ba53393c | - setTextAlignment:
    [ 2 ]    M: 0x1ba5328d8 | - setText:
    [ 3 ]    M: 0x1ba533a40 | - setHighlightedTextColor:
    [ 4 ]    M: 0x1ba53ba58 | - setAutotrackTextToFit:
    
    call(0x1ba5328d8, 0x102e07840, ObjC.selector("- setText:"), allocOCString("123123123"))
 */
const debugLog = false;
globalThis.call = (ptr, ...args) => {
    try {
        const target = checkPointer(ptr);
        if (debugLog)
            logw(`Called -> Address: ${target}${typeof ptr == "string" ? ` ${ptr}\t` : ''} | Arguments [ ${args.length} ] -> ${args}`);
        const argsStr = args.map(arg => typeof arg === 'number' ? `"pointer"` : `"pointer"`).join(', '); // All types are treated as pointer
        const func = eval(`new NativeFunction(new NativePointer(${target}), 'pointer', [ ${argsStr} ])`);
        if (typeof func !== 'function')
            throw new Error("Error while Created NativeFunction");
        return func(...args.map(item => checkPointer(item)));
    }
    catch (error) {
        throw new Error(`Error during call: \n\t${error}`);
    }
};
globalThis.callOC = (objPtr, funcName, ...args) => {
    return new ObjC.Object(checkPointer(objPtr))[funcName](...args);
    // return call(ptr(new ObjC.Object(checkPointer(objPtr))[funcName].implementation), objPtr, ObjC.selector(funcName), ...args)
};
/**
 * OC call on main thread
 *
 * @param objPtr
 * @param funcName
 * @param args
 *
 * example : callOcOnMain(0x102e07840, "- setText:", allocOCString("test"))
 */
globalThis.callOcOnMain = (objPtr, funcName, ...args) => {
    ObjC.schedule(ObjC.mainQueue, () => {
        const ret = callOC(objPtr, funcName, ...args);
        if (ret != undefined)
            logd(`${ret}`);
    });
};
const bytesToUTF8 = (data) => {
    // Sample Objective-C
    // char buf[] = "\x41\x42\x43\x44";
    // NSString *p = [[NSString alloc] initWithBytes:buf length:5 encoding:NSUTF8StringEncoding];
    if (data === null) {
        return "";
    }
    if (!data.hasOwnProperty("bytes")) {
        return data.toString();
    }
    const s = ObjC.classes.NSString.alloc().initWithBytes_length_encoding_(data.bytes(), data.length(), NSUTF8StringEncoding);
    if (s) {
        return s.UTF8String();
    }
    return "";
};
globalThis.lfs = (ptr, ret = false) => {
    const mPtr = checkPointer(ptr);
    const obj = new ObjC.Object(mPtr); // class handle
    if (obj.$kind != "instance")
        throw new Error("ivars | can only parse instance");
    showSuperClasses(obj.handle);
    const $clonedIvars = {};
    const vars = obj.$ivars;
    let index = 0;
    for (const k in vars) {
        try {
            if (vars.hasOwnProperty(k)) {
                const v = vars[k];
                $clonedIvars[k] = bytesToUTF8(v);
                if (ret)
                    continue;
                if (v instanceof ObjC.Object) {
                    logd(`[${++index}] ${k}: | ObjC.Object <- ${v.$kind} of ${v.$className} @ ${v.$class.handle}`);
                    logz(`\t${v.handle}`);
                }
                else if (typeof v == "object") {
                    logd(`[${++index}] ${k}: | ${typeof v}`);
                    logz(`\t${v}`);
                }
                else {
                    logd(`[${++index}] ${k}: | ${typeof v}`);
                    logz(`\t${$clonedIvars[k]}`);
                }
            }
        }
        catch (error) {
        }
    }
    if (ret)
        return $clonedIvars;
    function extInfo() {
    }
};
var passValueKey;
(function (passValueKey) {
    passValueKey["org"] = "org";
    passValueKey["src"] = "src";
    passValueKey["enter"] = "enter";
    passValueKey["leave"] = "leave";
    passValueKey["time"] = "time";
})(passValueKey || (passValueKey = {}));
var map_attach_listener = new Map();
const attachNative = (mPtr, mOnEnter, mOnLeave, needRecord = true) => {
    if (typeof mPtr == "number")
        mPtr = ptr(mPtr);
    if (mPtr instanceof NativePointer && mPtr.isNull())
        return;
    var passValue = new Map();
    passValue.set(passValueKey.org, mPtr);
    passValue.set(passValueKey.src, mPtr);
    passValue.set(passValueKey.enter, mOnEnter);
    passValue.set(passValueKey.leave, mOnLeave);
    passValue.set(passValueKey.time, new Date());
    mPtr = checkPointer(mPtr);
    let Listener = Interceptor.attach(mPtr, {
        onEnter: function (args) {
            if (mOnEnter != undefined)
                mOnEnter(args, this.context, passValue);
        },
        onLeave: function (retval) {
            if (mOnLeave != undefined)
                mOnLeave(retval, this.context, passValue);
        }
    });
    if (needRecord)
        map_attach_listener.set(String(mPtr), Listener);
};
const detachAll = (mPtr) => {
    if (typeof mPtr == "number")
        mPtr = ptr(mPtr);
    if (mPtr == undefined) {
        map_attach_listener.clear();
        Interceptor.detachAll();
    }
    else {
        let key = String(checkPointer(mPtr));
        let listener = map_attach_listener.get(key);
        if (listener != undefined) {
            listener.detach();
            map_attach_listener.delete(key);
        }
    }
};
var arr_nop_addr = new Array();
function replaceFunction(mPtr, callBack, TYPENOP = true) {
    mPtr = checkPointer(mPtr);
    if (String(arr_nop_addr).indexOf(String(mPtr)) == -1) {
        arr_nop_addr.push(String(mPtr));
    }
    else {
        Interceptor.revert(mPtr);
    }
    const srcFunc = new NativeFunction(mPtr, 'pointer', ['pointer', 'pointer', 'pointer', 'pointer']);
    Interceptor.replace(mPtr, new NativeCallback((arg0, arg1, arg2, arg3) => {
        logw("\nCalled " + (TYPENOP ? "Replaced" : "Nop") + " function ---> " + mPtr);
        const ret = callBack(srcFunc, arg0, arg1, arg2, arg3);
        return ret == null ? ptr(0) : ret;
    }, 'pointer', ['pointer', 'pointer', 'pointer', 'pointer']));
}
const nopFunction = (mPtr) => {
    if (typeof mPtr == "number")
        mPtr = ptr(mPtr);
    if (mPtr == undefined)
        return;
    replaceFunction(mPtr, () => ptr(0), true);
};
const cancelNop = (mPtr) => {
    mPtr = checkPointer(mPtr);
    Interceptor.revert(mPtr);
    for (let i = 0; i < arr_nop_addr.length; i++) {
        if (String(arr_nop_addr[i]) == String(mPtr)) {
            arr_nop_addr = arr_nop_addr.splice(arr_nop_addr[i], 1);
        }
    }
};
const cancelAllNopedFunction = () => arr_nop_addr.forEach((addr) => Interceptor.revert(addr));
const stk = (mPtr) => {
    Interceptor.attach(checkPointer(mPtr), {
        onEnter: function (args) {
            logw(`ENTER: ${mPtr}\n\tINS=${new ObjC.Object(args[0])} SEL=${ObjC.selectorAsString(args[1])}`);
            logw(`\tARG2=${new ObjC.Object(args[2])} ARG3=${new ObjC.Object(args[3])} ... `);
            Stalker.follow(Process.getCurrentThreadId(), {
                events: {
                    exec: true
                },
                onReceive: function (events) {
                    const bbs = Stalker.parse(events, {
                        stringify: false,
                        annotate: false
                    });
                    logd("↓ Stalker trace ↓\n");
                    logd(bbs.flat().map(item => DebugSymbol.fromAddress(ptr(item))).join('\n'));
                }
            });
        },
        onLeave: function (retval) {
            Stalker.unfollow();
            Stalker.flush();
        }
    });
};
globalThis.isObjcInstance = (mPtr) => {
    if (mPtr == undefined || mPtr.isNull())
        return NULL;
    try {
        return call("object_getClass", mPtr).readPointer();
    }
    catch (error) {
        return NULL;
    }
};
// +[UPWDeviceUtil deviceOSVersion] => {clsName, methodName}
globalThis.nameToMethod = (method) => {
    if (method[1] == '[' && method.endsWith(']')) {
        let methodL = method.slice(2, -1);
        const parts = methodL.split(' ');
        if (parts.length != 2)
            throw new Error("Invalid format, there should be exactly one space.");
        const className = parts[0];
        const classMethod = `${method[0]} ${parts[1]}`;
        return ObjC.classes[className][classMethod];
    }
    else {
        throw new Error("Invalid format, should start with '+[' / '-[' and end with ']'");
    }
};
globalThis.addressToMethod = (mPtr) => {
    return nameToMethod(DebugSymbol.fromAddress(mPtr).name);
};
globalThis.showAsm = (mPtr, len = 0x20) => {
    const l_mPtr = checkPointer(mPtr);
    let next = l_mPtr;
    newLine();
    while (len-- > 0) {
        try {
            const ins = Instruction.parse(next);
            logd(`${ins.address} ${ins.mnemonic} ${ins.opStr}`);
            next = ins.next;
        }
        catch (error) {
            // ...   
        }
    }
    newLine();
};
globalThis.asOcObj = (mPtr) => {
    return new ObjC.Object(ptr(mPtr));
};
globalThis.demangleName = (expName) => {
    // DebugSymbol.fromName("__cxa_demangle")
    const demangleAddress = Module.findExportByName(null, '__cxa_demangle');
    if (demangleAddress == null)
        throw Error("can not find export function -> __cxa_demangle");
    const demangle = new NativeFunction(demangleAddress, 'pointer', ['pointer', 'pointer', 'pointer', 'pointer']);
    const mangledName = Memory.allocUtf8String(expName);
    const outputBuffer = NULL;
    const length = NULL;
    const status = Memory.alloc(Process.pageSize);
    const result = demangle(mangledName, outputBuffer, length, status);
    if (status.readInt() === 0) {
        let resultStr = result.readUtf8String();
        return (resultStr == null || resultStr == expName) ? "" : resultStr;
    }
    else
        return "";
};
globalThis.getSym = (filterName, mdName) => {
    if (mdName == undefined) {
        return Process.enumerateModules()
            .flatMap(module => module.enumerateSymbols())
            .filter(item => item.name.includes(filterName) || demangleName(item.name).includes(filterName));
    }
    else {
        const module = Process.findModuleByName(mdName);
        if (!module) {
            logw(`Module '${mdName}' not found...`);
            return undefined;
        }
        return module.enumerateSymbols()
            .filter(item => item.name.includes(filterName) || demangleName(item.name).includes(filterName));
    }
};
globalThis.findSym = (filterName, imageName = "", onlyFunction = false) => {
    if (filterName == undefined)
        throw new Error('filterName can not be null ...');
    newLine();
    if (imageName != undefined && imageName.length > 0) {
        if (imageName.includes('*')) {
            Process.enumerateModules().filter(item => item.name.includes(imageName.replace('*', ''))).forEach(i => (iteratorName(i)));
        }
        else {
            iteratorName(Process.findModuleByName(imageName));
        }
    }
    else if (imageName != undefined && imageName != "") {
        iteratorName(Process.findModuleByName(imageName));
    }
    else {
        Process.enumerateModules().forEach(iteratorName);
    }
    function iteratorName(md) {
        if (md == null)
            throw new Error('Module can not be null ...');
        const syms = md.enumerateSymbols();
        const filterSyms = syms.map(item => { return { msd: item, demangeName: demangleName(item.name), rva: item.address.sub(md.base) }; })
            .filter(item => item.demangeName.includes(filterName) || item.msd.name.includes(filterName))
            .filter(item => onlyFunction ? item.msd.type == 'function' : true)
            .filter(item => !item.msd.address.isNull());
        if (filterSyms.length == 0)
            return;
        logw(`Found { ${filterSyms.length} / ${syms.length} } in '${md.path}'\n`);
        filterSyms.forEach((item, index) => {
            logd(`[${index}] \t${item.msd.address} -> \t${item.msd.name}`);
            if (item.demangeName.length != 0)
                logz(`\t\t\t${item.demangeName} | ${item.rva}`);
        });
        newLine();
    }
};
globalThis.sleep = (sec) => new NativeFunction(DebugSymbol.fromName("sleep").address, 'pointer', ['int'])(sec);
const _getAddr__mod_init_func = (sectionName = "__mod_init_func", moduleName = Process.mainModule.name) => {
    return Process.getModuleByName(moduleName).enumerateSections().find(item => item.name.includes(sectionName));
};
export var HK_TYPE;
(function (HK_TYPE) {
    HK_TYPE[HK_TYPE["FRIDA_ATTACH"] = 0] = "FRIDA_ATTACH";
    HK_TYPE[HK_TYPE["FRIDA_REP"] = 1] = "FRIDA_REP";
    HK_TYPE[HK_TYPE["OBJC_REP"] = 2] = "OBJC_REP";
})(HK_TYPE || (HK_TYPE = {}));
globalThis.d = detachAll;
globalThis.A = attachNative;
globalThis.n = nopFunction;
globalThis.nn = cancelNop;
globalThis.nnn = cancelAllNopedFunction;
globalThis.D = () => { d(); nnn(); };
globalThis.stk = stk;